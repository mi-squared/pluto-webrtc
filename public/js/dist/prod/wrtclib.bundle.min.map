{
  "version": 3,
  "sources": [
    "node_modules/browserify/node_modules/browser-pack/_prelude.js",
    "public/js/mylib/emitter.js",
    "public/js/mylib/utils.js",
    "public/js/wrtclib/connection/_RTCPeerConnection.js",
    "public/js/wrtclib/connection/connection.js",
    "public/js/wrtclib/connection/endpoint.js",
    "public/js/wrtclib/connection/lwrtcPeerConnection.js",
    "public/js/wrtclib/connection/wrtcPeerConnection.js",
    "public/js/wrtclib/containers/basicContainer.js",
    "public/js/wrtclib/containers/videoContainer.js",
    "public/js/wrtclib/containers/videoHolder.js",
    "public/js/wrtclib/localMedia/detectRTC.js",
    "public/js/wrtclib/localMedia/localMedia.js",
    "public/js/wrtclib/localMedia/mediaConstraints.js",
    "public/js/wrtclib/localMedia/userMediaController.js"
  ],
  "names": [],
  "mappings": "AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5UA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC39BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/bA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/tBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtcA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5VA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA",
  "file": "generated.js",
  "sourceRoot": "file:///home/alykoshin/sync/al-projects/odesk/05-WebRTC for TeleHealth/source",
  "sourcesContent": [
    "(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})",
    "/**\n * Created by alykoshin on 9/3/14.\n */\n\n'use strict';\n\n/**\n *\n * Based on WildEmitter\n * @see {@link https://github.com/HenrikJoreteg/wildemitter/blob/master/wildemitter.js}\n *\n * Also good emitter is {@link https://github.com/asyncly/EventEmitter2}\n *\n * Usage:\n *   obj = {}; Emitter(obj);\n *   obj.on('something', function(param) { console.log(arguments); } );\n *   obj.emit('something', 'data1', 'data2');\n *\n * @class Emitter\n * @mixin\n * @constructor\n */\n\nvar Emitter = function(that) {\n\n  /**\n   * @type {{}}\n   * @memberOf Emitter\n   */\n  that.callbacks = {};\n\n  /**\n   * Listen on the given 'eventName' with 'fn'. Store a group name if present.\n   *\n   * @memberOf Emitter\n   * @param {string || string[]} eventNames\n   * @param {string} [groupName]\n   * @param {callback} fn\n   **/\n  that.on = function (eventNames, groupName, fn) {\n//    that._assertName(eventName);\n    if (!eventNames) { throw 'Emitter.on(): eventNames not provided'; }\n\n    if (typeof eventNames === 'string') { eventNames = [eventNames]; }\n    var hasGroup = (arguments.length === 3),\n      group = hasGroup ? arguments[1] : undefined,\n      func  = hasGroup ? arguments[2] : arguments[1];\n\n    func._groupName = group;\n    for (var len=eventNames.length, i=0; i<len; ++i) {\n      var eventName = eventNames[i];\n      that.callbacks[eventName] = that.callbacks[eventName] || [];\n      that.callbacks[eventName].push(func);\n    }\n    return that;\n  };\n\n  /**\n   * Adds an `eventName` listener that will be invoked a single\n   * time then automatically removed.\n   *\n   * @param {string || string[]} eventNames\n   * @param {string} [groupName]\n   * @param {callback} fn\n   **/\n  that.once = function (eventNames, groupName, fn) {\n    if (!eventNames) { throw 'Emitter.once(): eventNames not provided'; }\n\n    function doOnceClosure(eventName) {\n      return function doOnce() {\n        that.off(eventName, doOnce);\n        func.apply(that, arguments);\n      };\n    }\n//    that._assertName(eventName);\n    if (typeof eventNames === 'string') { eventNames = [eventNames]; }\n    var hasGroup = (arguments.length === 3),\n      group = hasGroup ? arguments[1] : undefined,\n      func  = hasGroup ? arguments[2] : arguments[1];\n\n    for (var len=eventNames.length, i=0; i<len; ++i) {\n      var eventName = eventNames[i];\n\n      that.on(eventName, group, doOnceClosure(eventName));\n    }\n    return that;\n  };\n\n  /**\n   * Unbinds an entire group\n   *\n   * memberOf Emitter\n   * @param {string} groupName\n   **/\n\n  that.releaseGroup = function (groupName) {\n    for (var eventName in that.callbacks) {\n      if ( that.callbacks.hasOwnProperty(eventName) ) {\n        var callbacks = that.callbacks[eventName];\n        var i = 0;\n        while (i < callbacks.length) {\n          if (callbacks[i]._groupName === groupName) {\n            callbacks.splice(i, 1);\n          } else {\n            i++;\n          }\n        }\n      }\n    }\n    return that;\n  };\n\n\n  /**\n   * Remove the given callback for `eventName` or all\n   * registered callbacks.\n   *\n   * @param {string || string[]} eventNames\n   * @param {callback} fn\n   **/\n  that.off = function (eventNames, fn) {\n    //   that._assertName(eventName);\n    if (!eventNames) { throw 'Emitter.off(): eventNames not provided'; }\n\n    if (typeof eventNames === 'string') { eventNames = [eventNames]; }\n\n    for (var len=eventNames.length, i=0; i<len; ++i) {\n      var eventName = eventNames[i];\n\n      var eventCallbacks = that.callbacks[eventName];\n\n      if (!eventCallbacks) {\n        continue;\n      }\n\n      // remove all handlers\n      if (arguments.length === 1) {\n        // delete that.callbacks[eventName];\n        that.callbacks[eventName] = [];\n        continue;\n      }\n\n      // remove specific handler\n      var idx = eventCallbacks.indexOf(fn);\n      eventCallbacks.splice(idx, 1);\n      continue;\n    }\n    return that;\n  };\n\n  /** Emit `eventName` with the given args.\n   * also calls any `*` handlers\n   *\n   * @param {string} eventName\n   **/\n  that.emit = function (eventName) {\n//    that._assertName(eventName);\n    if (!eventName) { throw 'Emitter.emit(): eventName not provided'; }\n\n    var args = [].slice.call(arguments, 1),\n      callbacks        = that.callbacks[eventName],\n      specialCallbacks = that.getWildcardCallbacks(eventName),\n      i,\n      len,\n      handled = false,\n//    item,\n      listeners;\n\n    if (callbacks) {\n      listeners = callbacks.slice();\n      for (i = 0, len = listeners.length; i < len; ++i) {\n        if (listeners[i]) {\n          // debug.log('Emitter: ' + typeof this + '.on(' + eventName + ', ', arguments, ')');\n          listeners[i].apply(that, args);\n          handled = true;\n        } else {\n          break;\n        }\n      }\n    }\n\n    if (specialCallbacks) {\n      //len = specialCallbacks.length;\n      listeners = specialCallbacks.slice();\n      for (i = 0, len = listeners.length; i < len; ++i) {\n        if (listeners[i]) {\n          debug.log('Emitter: ' + typeof this + '.on(' + eventName + ', ', arguments, ')');\n          listeners[i].apply(that, /*[eventName].concat(*/args/*)*/);\n          handled = true;\n        } else {\n          break;\n        }\n      }\n    }\n\n    if (!handled) { debug.warn('Emitter: Event emitted, but not handled:', eventName); }\n\n    return that;\n  };\n\n  /**\n   * Helper for for finding special wildcard event handlers that match the event\n   *\n   * @param {string} eventName\n   **/\n  that.getWildcardCallbacks = function (eventName) {\n    var item,\n      split,\n      result = [];\n\n    for (item in that.callbacks) {\n      if (that.callbacks.hasOwnProperty(item)) {\n        split = item.split('*');\n        if (item === '*' || (split.length === 2 && eventName.slice(0, split[0].length) === split[0])) {\n          result = result.concat(that.callbacks[item]);\n        }\n      }\n    }\n    return result;\n  };\n\n  return that;\n};\n\n\n\n\nvar ValidatingEmitter = function(that) {\n\n  Emitter(that);\n\n  /**\n   * Array of registered events\n   *\n   * @type {Array}\n   * @memberOf Emitter\n   */\n\n  that.registered = [];\n\n//  that.findReg = function(eventName/*, groupName*/) {\n//    //groupName = groupName || undefined;\n//    for (var i= 0; i < that.registered.length; i++) {\n//      if (that.registered[i].eventName === eventName /*&& that.registered[i].groupName === groupName*/) {\n//        return i;\n//      }\n//    }\n//    return -1;\n//  };\n\n  that.isRegistered = function(eventName/*, groupName*/) {\n    //groupName = groupName || undefined;\n    //return (that.findReg(eventName/*, groupName*/) >= 0);\n    return that.registered.indexOf(eventName) >= 0;\n  };\n\n  that._assertName = function(eventName/*, groupName*/) {\n    //groupName = groupName || undefined;\n    if ( ! that.isRegistered(eventName/*, group*/) ) {\n      throw('Emitter.on(): Event is not regged' +\n      ': eventName: \\''+eventName + '\\'' /* +\n       '; groupName: \\''+group     + '\\'' */ );\n    }\n  };\n\n  /**\n   * Register new Event\n   *\n   * @param eventName\n   */\n  that.reg = function(eventName) {\n    that.registered.push( eventName );\n  };\n\n  /**\n   * Unregister Event\n   *\n   * @param eventName\n   */\n  that.unreg = function(eventName) {\n    var i = that.registered.indexOf(eventName);\n    that.registered.splice(i,1);\n  };\n\n  var old_on = that.on;\n  that.on = function (eventName, groupName, fn) {\n    that._assertName(eventName);\n    return old_on(eventName, groupName, fn);\n  };\n\n  var old_once = that.once;\n  that.once = function (eventName, groupName, fn) {\n    that._assertName(eventName);\n    return old_once(eventName, groupName, fn);\n  };\n\n  /**\n   * Remove the given callback for `eventName` or all\n   * registered callbacks.\n   *\n   * @param {string} eventName\n   * @param {callback} fn\n   **/\n\n  var old_off = that.off;\n  that.off = function (eventName, fn) {\n    that._assertName(eventName);\n    return old_off(eventName, groupName, fn);\n  };\n\n  /** Emit `eventName` with the given args.\n   * also calls any `*` handlers\n   *\n   * @param {string} eventName\n   **/\n  var old_emit = that.emit;\n  that.emit = function (eventName) {\n    that._assertName(eventName);\n    return old_emit(eventName);\n  };\n\n  return that;\n};\n\n\nif (typeof module !== 'undefined') {\n  module.exports = Emitter;\n}\n\nif (typeof window !== 'undefined') {\n  window.Emitter  = Emitter;\n}\n",
    "/**\n * Created by alykoshin on 3/23/14.\n */\n\n'use strict';\n\n/**\n * Returns whether the script runs on Server side (Node.js)\n * @returns {boolean}\n */\nfunction isServer( ) {\n  return (typeof document === 'undefined');\n}\n\n/**\n * Returns whether the script runs on Client side (Browser)\n * @returns {boolean}\n */\nfunction isClient() {\n  return ! isServer();\n}\n\n//isClient();\n\n/**\n * Constants\n **/\n\n/** @type {number} **/\nvar ONE_SECOND_MSEC = 1000;\n/** @type {number} **/\nvar ONE_MINUTE_MSEC = ONE_SECOND_MSEC * 60;\n/** @type {number} **/\nvar ONE_HOUR_MSEC   = ONE_MINUTE_MSEC * 60;\n/** @type {number} **/\nvar ONE_DAY_MSEC    = ONE_HOUR_MSEC   * 24;\n\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// Full version of `log` that:\n//  * Prevents errors on console methods when no console present.\n//  * Exposes a global 'log' function that preserves line numbering and formatting.\nvar _debug = function (obj) {\n  var that = {};\n\n  that.obj = obj;\n\n  var method;\n  var noop = function () {};\n  var methods = [\n    'assert', 'clear', 'count', 'debug', 'dir', 'dirxml', 'error',\n    'exception', 'group', 'groupCollapsed', 'groupEnd', 'info', 'log',\n    'markTimeline', 'profile', 'profileEnd', 'table', 'time', 'timeEnd',\n    'timeStamp', 'trace', 'warn'\n  ];\n\n  if ( typeof window !== 'undefined') {\n    window.console = window.console || {};\n    var console    = window.console;\n  }\n\n  if (!console['debug']) { console.debug = console.log; } // IE does not support debug.\n\n  var length = methods.length;\n  while (length--) {\n    method = methods[length];\n\n    // Only stub undefined methods.\n    if ( ! console[method] ) { // .hasOwnProperty(method) ) { // !console[method] ) {\n      console[method] = noop; // Disable for console\n      that[method]    = noop; // and for this object too\n    } else {\n      if (Function.prototype.bind) {\n        that[method] = Function.prototype.bind.call(console[method], console, '%s'); // '%s' does not works for group\n      } else {\n        that[method] = Function.prototype.apply.call(console[method], console, 'xyz',arguments);\n      }\n    }\n  }\n  //if(that.obj) {\n  //  console.log('>>>>>>>>>>>>', that.obj.debugId, that.obj);\n  // }\n  //  if (!console.debug) { // IE does not support console.debug\n  //    that.debug = Function.prototype.bind.call(console.log,   console, pref + ' **** debug:   %s');;\n  //  } else {\n  //    that.debug = Function.prototype.bind.call(console.debug, console, pref + ' **** debug: %s');\n  //  }\n\n  /** Rewrite specific methods **/\n  if (Function.prototype.bind) {\n    // console.log('_debug(): if (Function.prototype.bind) ');\n    var pref = '[' + ( (that.obj && that.obj.debugId) ? that.obj.debugId : 'null') +']';\n\n\n    that.error = Function.prototype.bind.call(console.error, console, pref + ' * error: %s');\n    that.warn  = Function.prototype.bind.call(console.warn , console, pref + ' ** warn:  %s');\n    that.info  = Function.prototype.bind.call(console.info,  console, pref + ' *** info:  %s');\n    if (!console.debug) { // IE does not support console.debug\n      that.debug = Function.prototype.bind.call(console.log,   console);//pref + ' **** debug:   %s');;\n    } else {\n      that.debug = Function.prototype.bind.call(console.debug, console);//pref + ' **** debug: %s');\n    }\n    that.log   = Function.prototype.bind.call(console.log,   console, pref + ' ***** log:   %s');\n    //    that.group = Function.prototype.bind.call(console.group, console, '%s');\n    that.group = Function.prototype.bind.call(console.log, console, pref + ' GROUP:   %s');\n    //    that.groupCollapsed = Function.prototype.bind.call(console.groupCollapsed, console, '%s');\n    that.groupCollapsed = Function.prototype.bind.call(console.log, console, pref + ' GROUP: %s');\n    //    if (!that.assert) { that.assert = Function.prototype.bind.call(console.error, console, '* assert: %s'); }\n    //  } else {\n    //    that.error = function() { Function.prototype.apply.call(console.error, console, arguments); };\n    //    that.warn  = function() { Function.prototype.apply.call(console.warn , console, arguments); };\n    //    that.info  = function() { Function.prototype.apply.call(console.info,  console, arguments); };\n    //    that.debug = function() { Function.prototype.apply.call(console.debug, console, arguments); };\n    //    that.log   = function() { Function.prototype.apply.call(console.log,   console, arguments); };\n  }\n\n  return that;\n};\nvar debug = _debug();\n//var debug = console;\n\nvar assert     = function(condition, message) {\n  if (!condition) {\n    throw message ? 'Assertion failed: \\'' + message +'\\'': 'Assertion failed.';\n  }\n};\n//var assert = debug.assert;\n\n//assert(false, 'test-message');\n\n//window.console = null;\n\n\n// My unsuccessful experiments........ :(\n\n\n/*\n // https://raw.githubusercontent.com/cowboy/javascript-debug/master/ba-debug.js\n window.debug = ( function(){\n var window = this,\n con = window.console,\n that = {}//,\n ;\n\n var dev_mode = true;\n that._debug = con.log.bind( con , '%s');\n */\n\n/*\n function //log\n // ( msgOrObj ){\n if(dev_mode){\n try {  invalidfunctionthrowanerrorplease(); }\n catch(err) {  var logStack = err.stack;  }\n var fullTrace = logStack.split('\\n');\n for( var i = 0 ; i < fullTrace.length ; ++i ){\n fullTrace[i] = fullTrace[i].replace(/\\s+/g, ' ');\n }\n var    caller = fullTrace[1],\n callerParts = caller.split('@'),\n caller = false,\n line = false;\n\n //CHROME & SAFARI\n if( callerParts.length == 1 ){\n var callerParts = fullTrace[2].split('('), caller = false;\n //we have an object caller\n if( callerParts.length > 1 ){\n caller = callerParts[0].replace('at Object.','');\n line = callerParts[1].split(':');\n line = line[2];\n }\n //called from outside of an object\n else {\n callerParts[0] = callerParts[0].replace('at ','');\n callerParts = callerParts[0].split(':');\n caller = callerParts[0]+callerParts[1];\n line = callerParts[2];\n }\n }\n //FIREFOX\n else {\n var callerParts2 = callerParts[1].split(':');\n line = callerParts2.pop();\n callerParts[1] = callerParts2.join(':');\n var caller = (callerParts[0] == '') ? callerParts[1] : callerParts[0];\n }\n console.log( ' ' );\n console.warn( 'Console log: '+ caller + ' ( line '+ line +' )' );\n console.log( msgOrObj );\n console.log({'Full trace:': fullTrace });\n console.log( ' ' );\n }\n }\n */\n\n/*\n\n ,\n function( // arguments\n ) {\n\n // http://stackoverflow.com/questions/1013239/can-i-get-the-name-of-the-currently-running-function-in-javascript\n //var callee = arguments.callee;//.toString().match(/function\\s+([^\\s\\(]+)/)[1];\n var caller = arguments.callee.caller;\n //caller = caller.callee;\n\n //console.debug('>>>>>>>>>>>>>1',arguments);\n //console.debug('>>>>>>>>>>>>>2',caller);\n //  console.debug('>>>>>>>>>>>>>3',caller2);\n //    console.debug('line:', /\\(file:[\\w\\d/.-]+:([\\d]+)/.exec(new Error().stack));\n\n // http://stackoverflow.com/questions/13610987/javascript-add-extra-argument\n var mainArgs   = Array.prototype.slice.call(arguments);\n\n // http://stackoverflow.com/questions/7942323/pass-arguments-to-console-log-as-first-class-arguments-via-proxy-function\n if ( typeof(con) !== 'undefined' ) {\n\n if (caller) {\n /*\n var callerName      = caller.toString().match(/function\\s+([^\\s\\(]+)/);\n callerName = callerName ? callerName[1] : '';\n var callerArguments = caller.arguments;\n\n // http://stackoverflow.com/questions/13610987/javascript-add-extra-argument\n var callerArgs = Array.prototype.slice.call(callerArguments);\n\n mainArgs.unshift( '): ');\n\n // Add quotes to string parameters\n for (var i = callerArgs.length-1; i >= 0; i--) {\n if (typeof callerArgs[i] === 'string') {\n callerArgs[i] = '\\'' + callerArgs[i] + '\\'';\n }\n mainArgs.unshift(callerArgs[i]);\n if (i !== 0) {\n mainArgs.unshift(',');\n }\n }\n\n mainArgs.unshift('function ' + callerName + ' (' );\n }\n }\n mainArgs.unshift('*');\n //mainArgs.callee = callee;\n\n //con.log( mainArgs );\n //con.log.apply( con, mainArgs);\n return mainArgs;\n }\n */\n\n\n\n/*\n that.error   = that._debug;\n that.warning = that._debug;\n that.info    = that._debug;\n that.debug   = that._debug;\n that.log     = that._debug;\n\n\n return that;\n })();\n */\n\n/**\n * Functions to handle cookies in plain JS\n *\n * http://www.w3schools.com/js/js_cookies.asp\n *\n * @param cname\n * @param cvalue\n * @param exdays\n */\nvar COOKIE_NEVER_EXPIRES = 20 * 365; // 20 years\n\nfunction setCookie(cname, cvalue, exdays) {\n  var d = new Date();\n  d.setTime(d.getTime() + (exdays*24*60*60*1000));\n  var expires = 'expires=' + d.toGMTString();\n  document.cookie = cname + '=' + cvalue + '; ' + expires;\n}\n\nfunction getCookie(cname) {\n  var name = cname + '=';\n  var ca = document.cookie.split(';');\n  for (var i = 0; i < ca.length; i++) {\n    var c = ca[i];\n    while (c.charAt(0) === ' ') { c = c.substring(1); }\n    if (c.indexOf(name) !== -1) { return c.substring(name.length,c.length); }\n  }\n  return '';\n}\n\nfunction checkCookie(name, value) {\n  var val = getCookie(name);\n  if (val === value) {\n    return true;\n  } else {\n    setCookie(name, val, COOKIE_NEVER_EXPIRES);\n    return false;\n  }\n}\n\n\n/**\n * http://befused.com/javascript/get-filename-url\n *\n * @returns {String}\n */\nvar getUrlFilename = function() {\n  //this gets the full url\n  var url = document.location.href;\n  //this removes the anchor at the end, if there is one\n  url = url.substring(0, (url.indexOf(\"#\") == -1) ? url.length : url.indexOf(\"#\"));\n  //this removes the query after the file name, if there is one\n  url = url.substring(0, (url.indexOf(\"?\") == -1) ? url.length : url.indexOf(\"?\"));\n  //this removes everything before the last slash in the path\n  url = url.substring(url.lastIndexOf(\"/\") + 1, url.length);\n  //return\n  return url;\n};\n\n\n/***********************************************************************************************************************\n * Change class of element from one to another and backwards\n * like: wrtcSpeakerOn -> wrtcSpeakerOff -> wrtcSpeakerOn ...\n *\n * @param {object} element\n * @param {string} class1\n * @param {string} class2\n */\nfunction elementFlipClass(element, class1, class2) {\n  var proto = Object.prototype.toString.call( element),\n    isArray = proto === '[object Array]' || proto === '[object HTMLCollection]';\n  var elements = isArray ? element : [element];\n  for (var len=elements.length, i=0; i<len; ++i) {\n    //console.log('len:', len,'; i:',i);\n    //console.log('elements[i]:',elements[i]);\n    //console.log('elements[i].className:', elements[i].className);\n\n    if ((' ' + elements[i].className + ' ').indexOf(' ' + class1 + ' ') > -1) {\n      elements[i].className = (' ' + elements[i].className + ' ').replace(' ' + class1 + ' ', ' ' + class2 + ' ');\n    } else {\n      elements[i].className = (' ' + elements[i].className + ' ').replace(' ' + class2 + ' ', ' ' + class1 + ' ');\n    }\n  }\n}\n\n\nvar WRTC_CSS_ON  = 'wrtcOn';\nvar WRTC_CSS_OFF = 'wrtcOff';\n/**\n *\n * @param {object||object[]} element\n */\nfunction elementFlipOnOff(element) {\n  elementFlipClass(element, WRTC_CSS_ON, WRTC_CSS_OFF);\n}\n\n/**\n *\n * @param {object||object[]} element\n */\nfunction elementOn(element) {\n  elementSetClass(element, WRTC_CSS_OFF, WRTC_CSS_ON);\n}\n/**\n *\n * @param {object||object[]} element\n */\nfunction elementOff(element) {\n  elementSetClass(element, WRTC_CSS_ON, WRTC_CSS_OFF);\n}\n\nfunction elementSetOnOff(element, isOn) {\n  if (isOn) {\n    elementOn(element);\n  } else {\n    elementOff(element);\n  }\n}\n\n/**\n * Set element class to some value (also remove if for element set, let's say, inverse class)\n * Like: wrtcEnabled -> wrtcDisabled\n *\n * @param {object||object[]} element\n * @param {string} classExisting\n * @param {string} classFinal\n */\nfunction elementSetClass(element, classExisting, classFinal) {\n  /** http://stackoverflow.com/questions/5898656/test-if-an-element-contains-a-class\n   * Using indexOf is correct, but you have to tweak it a little:\n   * Otherwise you will also get true if the class you are looking for is part of another class name.\n   */\n  var proto = Object.prototype.toString.call( element),\n    isArray = proto === '[object Array]' || proto === '[object HTMLCollection]';\n  var elements = isArray ? element : [element];\n  for (var len=elements.length, i=0; i<len; ++i) {\n\n    if ((' ' + elements[i].className + ' ').indexOf(' ' + classExisting + ' ') > -1) {\n      elementFlipClass(elements[i], classExisting, classFinal);\n    } else if ((' ' + elements[i].className + ' ').indexOf(' ' + classFinal + ' ') === -1) {\n      elements[i].className += ' ' + classFinal;\n    } else {\n      /** Do nothing as final class is already here **/\n    }\n\n  }\n}\n\nvar CSS_DISABLED = 'wrtcDisabled';\nvar CSS_ENABLED  = 'wrtcEnabled';\n/**\n * Set element class to wrtcDisabled (also remove wrtcEnabled if set)\n * and remove onclick handler\n */\nfunction elementDisable(element) {\n  elementSetClass(element, CSS_ENABLED, CSS_DISABLED);\n  element.onclick = null;\n}\n\n\nvar CSS_HIDDEN  = 'wrtcHidden';\nvar CSS_VISIBLE = 'wrtcVisible';\n/**\n * Set element class to wrtcHidden (also remove wrtcVisible if set)\n * and remove onclick handler\n */\nfunction elementHide(element) {\n  elementSetClass(element, CSS_VISIBLE, CSS_HIDDEN);\n}\n\nfunction elementFlipHidden(element) {\n  elementFlipClass(element, CSS_VISIBLE, CSS_HIDDEN);\n}\n\n\n/***********************************************************************************************************************\n *  Simple way to check if browser has minimal supports for WebRTC (check existence of getUserMedia function)\n *\n * @returns {boolean}\n */\nfunction isWebRTCCompatible() {\n  return !! (\n    (typeof getUserMedia !== 'undefined') // To avoid message 'SCRIPT5009: 'getUserMedia' is undefined'\n    && getUserMedia\n  );\n}\n\n/***********************************************************************************************************************\n * Get length of associative Array\n * http://stackoverflow.com/questions/5223/length-of-javascript-object-ie-associative-array\n *\n * @param obj\n * @returns {number}\n */\n\nObject.size = function(obj) {\n  var size = 0, key;\n  for (key in obj) {\n    if (obj.hasOwnProperty(key)) { size++; }\n  }\n  return size;\n};\n//\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//\n// http://stackoverflow.com/questions/152483/is-there-a-way-to-print-all-methods-of-an-object-in-javascript\n// Using it:\n//    console.log(getMethods(document).join('\\n'));\n//\nfunction getMethods(obj) {\n  var result = [];\n  for (var id in obj) {\n    try {\n      if (typeof(obj[id]) == 'function') {\n        result.push(id + ': ' + obj[id].toString());\n      }\n    } catch (err) {\n      result.push(id + ': inaccessible');\n    }\n  }\n  return result;\n}\n//\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// Extract parameters from page URL\n//\nfunction getURLParameter(name) {\n  var re = new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)');\n  return decodeURIComponent((re.exec(location.search)||[,''])[1].replace(/\\+/g, '%20')) || null;\n}\n//\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript\n//\nfunction s4() {\n  return Math.floor((1 + Math.random()) * 0x10000)\n    .toString(16)\n    .substring(1);\n}\n\nfunction guid() {\n  return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n    s4() + '-' + s4() + s4() + s4();\n}\n//\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// Generates random char+numbers id in the form 'ebfj1jmi7'\nvar STR_ID_LENGTH = 9;\n\nfunction genStrId() {\n  var res = '';\n  do {\n    // generate a random number and convert it to base 36 (0-9a-z):\n    res += Math.random().toString(36).substr(2, STR_ID_LENGTH); // remove `0.`\n  } while (res.length < STR_ID_LENGTH);\n  if (res.length > STR_ID_LENGTH) {\n    res = res.substr(1, STR_ID_LENGTH);\n  }\n  return res;\n}\n\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\nvar NUM_ID_LENGTH = 5;\n\n// Simplest way to pad number with leading zeroes\nfunction pad(num, len) {\n  var s = num + '';\n  while (s.length < len) s = '0' + s;\n  return s;\n}\n\nfunction genNumId() {\n  var r = Math.floor(( Math.random()* Math.pow(10, NUM_ID_LENGTH) )+1);\n  // another solution:\n  // Math.random().toString().substr(2)\n  // then substring to needed number of symbols\n  return pad(r, NUM_ID_LENGTH);\n}\n\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n\n/**\n * http://stackoverflow.com/questions/5916900/detect-version-of-browser\n *\n * @returns {*} -- 'MSIE' / 'Chrome' / 'Firefox'\n */\nfunction get_browser(){\n  var\n    ua = navigator.userAgent,\n    tem,\n    M = ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\\/))\\/?\\s*(\\d+)/i) || [];\n  if(/trident/i.test(M[1])){\n    tem = /\\brv[ :]+(\\d+)/g.exec(ua) || [];\n    //return 'IE '+(tem[1]||'');\n    return 'MSIE';\n  }\n  if(M[1] === 'Chrome'){\n    tem = ua.match(/\\bOPR\\/(\\d+)/)\n    if(tem != null)   { return 'Opera '+tem[1]; }\n  }\n  M = M[2]? [M[1], M[2]]: [navigator.appName, navigator.appVersion, '-?'];\n  if ((tem = ua.match(/version\\/(\\d+)/i)) != null ) { M.splice(1,1,tem[1]); }\n  return M[0];\n}\n/**\n * http://stackoverflow.com/questions/5916900/detect-version-of-browser\n *\n * @returns {*} -- Value is major version number like: 10 (MSIE) / 34 (Chrome) / 30 (Firefox)\n */\nfunction get_browser_version(){\n  var\n    ua = navigator.userAgent,\n    tem,\n    M = ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\\/))\\/?\\s*(\\d+)/i) || [];\n  if(/trident/i.test(M[1])){\n    tem = /\\brv[ :]+(\\d+)/g.exec(ua) || [];\n    //return 'IE '+(tem[1]||'');\n    return /*'IE '+*/ (tem[1]||'');\n  }\n  if(M[1] === 'Chrome'){\n    tem = ua.match(/\\bOPR\\/(\\d+)/)\n    if(tem!=null)   {return 'Opera '+tem[1];}\n  }\n  M = M[2]? [M[1], M[2]]: [navigator.appName, navigator.appVersion, '-?'];\n  if ((tem = ua.match(/version\\/(\\d+)/i)) != null) { M.splice(1,1,tem[1]); }\n  return M[1];\n}\n//\n\n/**\n * Check Temasys plugin and get its version\n *\n * @returns {version|*|version|version|version|version}\n */\nfunction get_temasys_version() {\n  var version;\n  if (typeof Temasys !== 'undefined') {\n    // Version 0.8.794 and later\n    version = (typeof Temasys !== 'undefined') && Temasys.WebRTCPlugin && Temasys.WebRTCPlugin.TemRTCPlugin && Temasys.WebRTCPlugin.TemRTCPlugin.version;\n  } else {\n    // Version 0.8.770 and earlier\n    version = (typeof plugin !== 'undefined') && plugin() && plugin().version;\n  }\n  return version;\n}\n\nfunction set_temasys_debug(debugLevel) {\n  var p;\n  if ( (typeof Temasys !== 'undefined') && Temasys.WebRTCPlugin && Temasys.WebRTCPlugin.TemRTCPlugin ) {\n    // Version 0.8.794 and later\n    p = Temasys.WebRTCPlugin.TemRTCPlugin;\n    p.setLogFunction(debug);\n    p.setLogLevel(debugLevel);\n  } else if ( (typeof plugin !== 'undefined') && plugin() ) {\n    // Version 0.8.770 and earlier\n    p = plugin();\n    p.setLogFunction(debug);\n    p.setLogLevel(CONFIG.TEMASYS.DEBUG_LEVEL);\n  } else {\n    debug.error('set_temasys_debug(): unable to access plugin');\n  }\n\n}\n//\n\nif (isClient())  {\n  debug.info('get_browser:', get_browser(), '; get_version:', get_browser_version());\n  var v = get_temasys_version();\n  debug.info('get_temasys_version():', v ? v : 'Not installed.');\n}\n//\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n// http://stackoverflow.com/questions/287903/enums-in-javascript\n/*\n function Enum() {\n var that = this;\n for (var i in arguments) {\n that[arguments[i]] = i;\n }\n this.name = function(value) {\n for (var key in that) {\n if (that[key] == value) {\n return key;\n }\n }\n };\n this.exist = function(value) {\n return (typeof that.name(value) !== 'undefined');\n };\n if (Object.freeze) {\n Object.freeze(that);\n }\n }\n Object.defineProperty(Object.prototype,'Enum', {\n value: function() {\n for(i in arguments) {\n Object.defineProperty(this,arguments[i], {\n value:parseInt(i),\n writable:false,\n enumerable:true,\n configurable:true\n });\n }\n return this;\n },\n writable:false,\n enumerable:false,\n configurable:false\n });\n */\n\n/*Object.prototype.toEnum = function() {\n var that = {};\n\n for (var prop in this) {\n if (that.hasOwnProperty(prop) && that[prop] === value) {\n that[prop] = this[prop];\n }\n }\n that.getByValue = function(value) {\n for (var prop in that) {\n if (that.hasOwnProperty(prop) && that[prop] === value) {\n return prop;\n }\n }\n return null;\n };\n\n that.exist = function(value) {\n return that.getByValue(value);\n };\n\n if (Object.freeze) {\n Object.freeze(that);\n }\n\n return that;\n };*/\n\nvar Enum = function( obj ) {\n\n  obj.getByValue = function(value) {\n    for (var prop in obj) {\n      if (obj.hasOwnProperty(prop) && obj[prop] === value) {\n        return prop;\n      }\n    }\n    return null;\n  };\n\n  obj._propExists = function(propName) {\n    return !! obj[propName];\n  };\n\n  obj.valueExists = function(valueName) {\n    return !! obj.getByValue(valueName);\n  };\n\n  obj.exist = function(valueName) {\n    debug.warn('Enum.exist() - deprecated.');\n\n    return obj.valueExists(valueName);\n  };\n\n  obj.check = function(valueName) {\n    assert(obj.valueExists(valueName), 'ERROR: Enum '+JSON.stringify(obj)+' does not have property value \\''+valueName+'\\'');\n  };\n\n  obj = Const(obj);\n\n  return obj;\n};\n\nvar Const = function(obj) {\n  if (Object.freeze) {\n    Object.freeze(obj);\n  }\n  return obj;\n};\n\n/**\n *\n * @param element                 - HTML Element\n * @param {string} eventName      - Event name\n * @param {function} eventHandler - Event handler\n */\nfunction addEvent(element, eventName, eventHandler) {\n  //debug.log('addEvent(): element:', element);\n  assert(element && eventName && ( (typeof eventHandler === \"function\") || eventHandler === null),\n    'addEvent: Invalid parameters: element:'+element+'; eventName:'+eventName+'; eventHandler: '+eventHandler);\n  /** Unify event name ('onload' -> 'load')\n   * Suggesting that it is not possible to have eventName like 'onon...' **/\n  if (eventName.slice(0, 2) === 'on') {\n    eventName = eventName.slice(2);\n  }\n  /** Add event handler to the object **/\n  if (element.addEventListener) {    /** W3C standard **/\n    // debug.log('addEvent(): element:', element, '; eventName: \\'' + eventName);// + '\\'; handler:', handler);\n\n  element.addEventListener(eventName, eventHandler, false); /** NB **not** 'onload' **/\n  } else if (element.attachEvent) {  /** Microsoft **/\n  element.attachEvent('on' + eventName, eventHandler);\n  } else {\n    debug.warn('The browser does not support Javascript event binding');\n    if ( element['on' + eventName] !== undefined) { /** Last chance **/\n    element['on' + eventName] = eventHandler\n    }\n  }\n}\n\n/**\n * Add event to HTML Element By its Id\n *\n * @param {string} elementId\n * @param {string} eventName\n * @param {function} eventHandler\n */\nfunction addEventById(elementId, eventName, eventHandler) {\n  var obj = document.getElementById(elementId);\n  if (obj) {\n    addEvent (obj, eventName, eventHandler);\n  } else {\n    debug.warn('addEventByClass(): Element with Id: \\''+elementId+'\\' not found.');\n  }\n}\n\n/**\n * Add event to HTML Element By its Class\n *\n * @param {Object} parent         - HTML Element\n * @param {string} className      - Class of elements to add event\n * @param {string} eventName      - Name of the event\n * @param {function} eventHandler - Event handler\n */\nfunction addEventByClass(parent, className, eventName, eventHandler) {\n  if (!parent) { debug.error('addEventByClass(): empty parent.'); }\n  var elements = parent.getElementsByClassName(className);\n  //debug.log('addEventByClass(): elements:', elements);\n  if (elements.length !== 0) {\n    for (var i = 0; i < elements.length; i++) {\n      addEvent (elements[i], eventName, eventHandler);\n    }\n  } else {\n    debug.warn('addEventByClass(): Elements with class: \\''+className+'\\' not found.');\n  }\n}\n\n\n/**\n * Set options (like style, disabled etc) for specified objects (by id)\n *\n * @todo Add option to set by elementClass, elementType or elementId\n *\n * Example of structure:\n * ---------------------\n * NORMAL: {\n *   'button1' : { style: { visibility: 'visible' } },\n *   'button2' : { style: { display:    'inline'  } }\n * }, IE: {\n *   'button1' : { disabled : false }\n * }\n *\n * @param {object} stateDefs\n */\nfunction setStates(stateDefs) {\n\n  /**\n   * Iterate recursively through all the properties of the definition and assign to target object\n   *\n   * @param {object} base\n   * @param {object} from\n   * @param {string} debugElementId\n   */\n  function assignRecursively(base, from, debugElementId) {\n    // debug.log('setStates(): assignRecursively(1): base:', base, '; from:', from);\n    for (var p1 in from) {\n      // debug.log('setStates(): assignRecursively(2): p1:', p1, '; base[p1]:', base[p1], '; from[p1]:', from[p1]);\n      if (from.hasOwnProperty(p1)) {\n        // debug.log('setStates(): assignRecursively(3): p1:', p1, '; base[p1]:', base[p1], '; from[p1]:', from[p1]);\n        if ( typeof from[p1] === \"object\") {\n          // debug.log('setStates(): assignRecursively(4): assignRecursively');\n          assignRecursively (base[p1], from[p1]); /** Going deeper **/\n        } else {\n          //          debug.log('setStates(): assignRecursively(5): assignment:',\n          //            base, '[', p1, ']=', base[p1],\n          //            '; ', from, '[', p1, ']=', from[p1]);\n          //          if (!base) throw('Invalid base for ElementId: ', debugElementId, '; base: ', base);\n          //          if (!from) throw('Invalid from for ElementId: ', debugElementId, '; from: ', from);\n          base[p1] = from[p1];          /** End of branch **/\n        }\n      }\n    }\n  }\n\n  /**\n   * Set states for one specific definition (i.e. 'NORMAL' or 'IE')\n   *\n   * @param {object} stateSubDefs\n   */\n  function setStates1(stateSubDefs) {\n    for ( var elementId in stateSubDefs ) { /** iterate through all the button element ids       **/\n      //debug.log('setStates(): elementId:', elementId);\n      if ( stateSubDefs.hasOwnProperty(elementId) ) {  /** check if it is not inherited property **/\n      var element      = document.getElementById(elementId); /** get document's HTML element       **/\n        if (!element) { debug.warn('Invalid Element, elementId:', elementId); }\n        else {\n          var elementProps = stateSubDefs[elementId];\n          //        debug.log('setStates(): elementId:', elementId, /*'; element:', element,*/ '; elementProps:', JSON.stringify(elementProps));\n          assignRecursively(element, elementProps, elementId);\n          //      debug.log('setStates(): element.style.visibility:', element.style.visibility);\n        }\n      }\n    }\n  }\n\n  debug.log('setStates()');\n  setStates1(stateDefs.NORMAL);     /** Set normal states for elements             **/\n  if ( get_browser() === 'MSIE' ) { /** ...but if browser is IE                    **/\n  setStates1(stateDefs.IE);       /** ...then override with IE specific settings **/\n  }\n}\n\n/**\n * http://stackoverflow.com/questions/46155/validate-email-address-in-javascript\n *\n * @param {string} email\n * @returns {boolean}\n */\nfunction validateEmail(email) {\n  var re = /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n  return re.test(email);\n}\n\nfunction validateName(value) {\n  var re = /./;\n  return re.test(value);\n}\n\n\n\nvar WRTCObject = function() {\n  this.debug = _debug(this);\n\n  WRTCObject.prototype.log   = this.debug.log; // function(/*arguments*/) { console.log(arguments) };\n  WRTCObject.prototype.debug = this.debug.debug;\n  WRTCObject.prototype.info  = this.debug.info;\n  WRTCObject.prototype.warn  = this.debug.warn;\n  WRTCObject.prototype.error = this.debug.error;\n\n  return this;\n};\n\n//WRTCObject.inherits(Object);\n\n\n// String Format function for String.prototype\n//\n// Example:\n//    \"{0} is dead, but {1} is alive! {0} {2}\".format(\"ASP\", \"ASP.NET\")\n// outputs\n//    ASP is dead, but ASP.NET is alive! ASP {2}\n//\n// Taken from: http://stackoverflow.com/a/4673436/2774010\n\nif (!String.prototype.format) { // First, checks if it isn't implemented yet.\n  String.prototype.format = function() {\n    var args = arguments;\n    return this.replace(/{(\\d+)}/g, function(match, number) {\n      return typeof args[number] != 'undefined'\n        ? args[number]\n        : match\n        ;\n    });\n  };\n}\n\nif (!String.prototype.formatObj) { // First, checks if it isn't implemented yet.\n  String.prototype.formatObj = function(hash) {\n    return this.replace(/{(\\w+)}/g, function(match, number) {\n      console.log('String.prototype.formatObj(): match:', match);\n      var prop = match.substr(1, match.length-2); // remove '{' and '}'\n      return typeof hash[prop] != 'undefined'\n        ? hash[prop]\n        : match  // Leave unchanged\n        ;\n    });\n  };\n}\n\n\n\nfunction loadTemplates( templates ) {\n  _.templateSettings = {\n    escape:      /<\\?-(.+?)\\?>/g,\n    evaluate:    /<\\?(.+?)\\?>/g,\n    interpolate: /<\\?=(.+?)\\?>/g\n  };\n  for (var name in templates) {\n    if (templates.hasOwnProperty(name)) {\n      var tmp = templates[name];\n      tmp.element = document.getElementById(tmp.id);\n      if (!tmp.element) { throw 'loadTemplates(): template not found: name: ' + name +'; id: ' + id; }\n      tmp.template = tmp.element.innerHTML;\n      //debug.log(tmp.template);\n      tmp.compiled = _.template(tmp.template);\n    }\n  }\n}\n\n\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nif (typeof module !== 'undefined') {\n  module.exports = {debug: debug};\n}\n\n",
    "/**\n * Created by alykoshin on 9/9/14.\n */\n\n'use strict';\n\nif ( typeof module !== 'undefined' && typeof require !== 'undefined') {\n  var debug   = require('./../../mylib/utils.js').debug;\n  var Emitter = require('./../../mylib/emitter.js');\n}\n\n/**\n * Low-level wrapper for RTCPeerConnection\n *\n * @class __RTCPeerConnection\n * @constructor\n * @returns {__RTCPeerConnection}\n * private\n */\n\nvar __RTCPeerConnection = function() {\n  var self = new WRTCObject();\n  Emitter(self);\n\n  /**\n   * @name rtcPeerConnection\n   * @memberOf __RTCPeerConnection\n   * @type {RTCPeerConnection}\n   * private\n   */\n  var rtcPeerConnection = null;\n\n  /**\n   * @name rtcPeerConnection\n   * @memberOf __RTCPeerConnection\n   * @type {RTCPeerConnection}\n   * @readOnly\n   */\n  Object.defineProperty(self, 'rtcPeerConnection', {\n    get: function () {\n      return rtcPeerConnection;\n    }\n  });\n\n  /**\n   * @name signalingState\n   * @memberOf __RTCPeerConnection\n   * @type {RTCSignalingState}\n   * @readOnly\n   */\n  Object.defineProperty(self, 'signalingState', {\n    /** @returns {RTCSignalingState} */\n    get:\n      function () {\n        return rtcPeerConnection ? rtcPeerConnection.signalingState : null;\n      }\n  });\n\n  /**\n   * @name iceConnectionState\n   * @memberOf __RTCPeerConnection\n   * @type {RTCIceConnectionState}\n   * @readOnly\n   */\n  Object.defineProperty(self, 'iceConnectionState', {\n    /** @returns {RTCIceConnectionState} */\n    get: function () {\n      return rtcPeerConnection ? rtcPeerConnection.iceConnectionState : null;\n    }\n  });\n\n  /**\n   * @name iceConnectionState\n   * @memberOf __RTCPeerConnection\n   * @type {RTCIceGatheringState}\n   * @readOnly\n   */\n  Object.defineProperty(self, 'iceGatheringState', {\n    /** @returns {RTCIceGatheringState} */\n    get: function () {\n      return rtcPeerConnection ? rtcPeerConnection.iceGatheringState : null;\n    }\n  });\n\n  /**\n   *\n   * @param rtcConfiguration\n   */\n  self._createPeerConnection = function(rtcConfiguration) {\n\n    // Create the WebRTC object RTCConnection\n\n    debug.log('__RTCPeerConnection._createPeerConnection(): rtcConfiguration:' + JSON.stringify(rtcConfiguration, null, 2));\n    rtcPeerConnection = new RTCPeerConnection(rtcConfiguration);\n\n    // Set RTCConnection events\n\n    /**\n     * @type RTCPeerConnection#onaddstream\n     * @fires _addstream\n     */\n    rtcPeerConnection.onaddstream = function(ev) {\n      self.emit('_addstream',    ev);\n    };\n\n    /**\n     * @type RTCPeerConnection#ondatachannel\n     * @fires _datachannel\n     */\n    rtcPeerConnection.ondatachannel = function(ev) {\n      self.emit('_datachannel',  ev);\n    };\n\n    /**\n     * @type RTCPeerConnection#onicecandidate\n     * @fires _icecandidate\n     */\n    rtcPeerConnection.onicecandidate = function(ev) {\n      self.emit('_icecandidate', ev);\n    };\n\n    /**\n     * @type RTCPeerConnection#oniceconnectionstatechange\n     * @fires _iceconnectionstatechange\n     */\n    rtcPeerConnection.oniceconnectionstatechange = function(ev) {\n      // It's better not to access self object as during destruction it may be already null\n      debug.log('rtcPeerConnection.oniceconnectionstatechange()' +\n        '; iceConnectionState:', ev.target.iceConnectionState,\n        '; iceGatheringState:',  ev.target.iceGatheringState,\n        '; ev:', ev);\n      self.emit('_iceconnectionstatechange', ev);\n    };\n\n    /**\n     * @type RTCPeerConnection#onnegotiationneeded\n     * @fires _negotiationneeded\n     */\n    rtcPeerConnection.onnegotiationneeded = function(ev) {\n      self.emit('_negotiationneeded', ev);\n    };\n\n    /**\n     * @type RTCPeerConnection#onremovestream\n     * @fires _removestream\n     */\n    rtcPeerConnection.onremovestream = function(ev) {\n      self.emit('_removestream', ev);\n    };\n\n    /**\n     * @type RTCPeerConnection#onsignalingstatechange\n     * @fires _signalingstatechange\n     */\n    rtcPeerConnection.onsignalingstatechange = function(ev) {\n      // It's better not to access self object as during destruction it may be already null\n      debug.log('rtcPeerConnection.onsignalingstatechange()' +\n        ': signalingState:', ev.target.signalingState,\n        '; ev:', ev);\n      self.emit('_signalingstatechange', ev);\n    };\n\n  };\n\n  /**\n   * Cleanup - close rtcPeerConnection and set it to null\n   *\n   * @memberOf _RTCPeerConnection\n   */\n\n  self.cleanup = function() {\n    debug.log('_RTCPeerConnection.cleanup()');\n    self.emit('close', self);\n    rtcPeerConnection.close();  // Close connection RTCPeerConnection\n    rtcPeerConnection = null;   // Remove reference to it\n  };\n\n  /**\n   *\n   * @param localDescription\n   * @private\n   */\n  self._createOfferSuccess = function(localDescription) {\n    //debug.log('__RTCPeerConnection._createOfferSuccess: localDescription:', localDescription);\n    self.emit('_createOfferSuccess', localDescription);\n  };\n\n  /**\n   *\n   * @param error\n   * @private\n   */\n  self._createOfferError = function(error) {\n    //debug.log('__RTCPeerConnection._createOfferError: error:', error);\n    self.emit('_createOfferError',   error);\n  };\n\n  /**\n   *\n   * @param {RTCOfferConstraints} constraints\n   * @fires _offerSuccess\n   * @fires _offerError\n   */\n  self._createOffer = function(constraints) {\n    self.emit('_createOffer', constraints);\n    rtcPeerConnection.createOffer( self._createOfferSuccess, self._createOfferError, constraints);\n  };\n\n  /**\n   *\n   * @param localDescription\n   * @fires _createAnswerSuccess\n   * @private\n   */\n  self._createAnswerSuccess = function(localDescription) {\n    self.emit('_createAnswerSuccess', localDescription);\n  };\n\n  /**\n   *\n   * @param error\n   * @fires _createAnswerError\n   * @private\n   */\n  self._createAnswerError = function(error) {\n    self.emit('_createAnswerError', error);\n  };\n\n  /**\n   *\n   * @param {RTCOfferConstraints} constraints\n   * @fires _answerSuccess\n   * @fires _answerError\n   */\n  self._createAnswer = function(constraints) {\n    self.emit('_createAnswer', constraints);\n    rtcPeerConnection.createAnswer( self._createAnswerSuccess, self._createAnswerError, constraints);\n  };\n\n  /**\n   * @method _addLocalStream\n   * @memberOf __RTCPeerConnection\n   * @param {MediaStream} stream\n   * @fires _addLocalStream - BEFORE calling RTCPeerConnection.addStream\n   */\n  self._addLocalStream = function (stream) {\n    self.emit('_addLocalStream', stream);\n    rtcPeerConnection.addStream( stream );\n  };\n  self.on('_addLocalStream',  function(ev) { debug.log('__RTCPeerConnection._addLocalStream(): ev:', ev); } );\n\n  /**\n   * @memberOf __RTCPeerConnection\n   * @param {RTCSessionDescription} localDescription\n   * @fires _setLocalDescription - BEFORE calling RTCPeerConnection.setLocalDescription\n   */\n  self._setLocalDescription = function(localDescription) {\n    self.emit('_setLocalDescription', localDescription);\n    self.rtcPeerConnection.setLocalDescription(localDescription);\n  };\n  self.on('_setLocalDescription',  function(ev) { debug.log('__RTCPeerConnection.on(): _setLocalDescription(): ev:', ev); } );\n\n  /**\n   * @memberOf __RTCPeerConnection\n   * @param {RTCSessionDescription} remoteDescription\n   * @fires _setRemoteDescription - BEFORE calling RTCPeerConnection.setRemoteDescription\n   */\n  self._setRemoteDescription = function(remoteDescription) {\n    self.emit('_setRemoteDescription', remoteDescription);\n    self.rtcPeerConnection.setRemoteDescription( new RTCSessionDescription(remoteDescription) );\n  };\n\n  return self;\n};\n\n\nvar _RTCPeerConnection = function ( rtcConfiguration ) {\n  var self = new __RTCPeerConnection();\n  self._createPeerConnection(rtcConfiguration);\n\n  /*\n   * 4.2.4 Offer/Answer Options\n   * These dictionaries describe the options that can be used to control the offer/answer creation process.\n   * dictionary RTCOfferOptions {\n   *  long    offerToReceiveVideo;\n   *  long    offerToReceiveAudio;\n   *  boolean voiceActivityDetection = true;\n   *  boolean iceRestart = false;\n   * };\n   */\n\n  /* Answer/Offer Constraints\n   * More info: http://dev.w3.org/2011/webrtc/editor/webrtc.html#idl-def-RTCOfferOptions\n   */\n    // Can be left empty - session is still ok (at least two-way video)\n  /**\n   * @type {RTCOfferConstraints}\n   */\n  self.OFFER_ANSWER_CONSTRAINTS = {\n    mandatory: {\n      OfferToReceiveVideo: true,\n      OfferToReceiveAudio: true\n    }\n  };\n  /**\n   * @type {RTCOfferConstraints}\n   */\n  self.offerConstraints  = _.clone(self.OFFER_ANSWER_CONSTRAINTS);\n  /**\n   * @type {RTCOfferConstraints}\n   */\n  self.answerConstraints = _.clone(self.OFFER_ANSWER_CONSTRAINTS);\n\n  /**\n   * Create offer\n   *\n   * @memberOf _RTCPeerConnection\n   */\n  self.createOffer = function() {\n    self._createOffer(self.offerConstraints);\n  };\n\n  /**\n   * Create answer\n   *\n   * @memberOf _RTCPeerConnection\n   */\n  self.createAnswer = function() {\n    self._createAnswer( self.answerConstraints );\n  };\n\n  /**\n   * @method addLocalStream\n   * @memberOf _RTCPeerConnection\n   * @param {MediaStreamController} mediaStream\n   */\n  self.addLocalStream = function (mediaStream) {\n    self._addLocalStream( mediaStream.stream );\n  };\n\n  return self;\n};\n\n\nif (typeof module !== 'undefined') {\n  //module.exports = __RTCPeerConnection;\n  module.exports = _RTCPeerConnection;\n}\n\nif (typeof window !== 'undefined') {\n  window._RTCPeerConnection  = _RTCPeerConnection;\n}\n",
    "/**\n * Created by alykoshin on 7/16/14.\n */\n'use strict';\n\nif ( typeof module !== 'undefined' && typeof require !== 'undefined') {\n  var debug   = require('./../../mylib/utils.js').debug;\n  var WRTCPeerConnection   = require('./wrtcPeerConnection.js');\n}\n\n/**\n * Wrapper for RTCPeerConnection\n *\n * @class BasicConnection\n * @param {{\n *   rtcConfiguration: {},\n *   audio_send_codec: String,\n *   audio_receive_codec: String,\n *   STEREO: {boolean},\n *   bandwidth: {string},\n *   BANDWIDTH_VOICE_LOW: number,\n *   BANDWIDTH_VIDEO_LOW: number\n * }} options\n * @returns {WRTCPeerConnection}\n * @constructor\n */\n\nvar BasicConnection = function ( options ) {\n\n  var DEFAULT_RTC_CONFIG = { iceServers: [\n    // { \"url\": \"stun:stun.stunprotocol.org:3478\" }\n    { \"url\": \"stun:stun.l.google.com:19302\" }\n    // { \"url\": \"turn:demo@wrtc.ru\", \"credential\": \"testing\" }\n    // { \"url\": \"turn:demo@wrtc.ru\", \"credential\": \"testing\" }\n  ] };\n\n  /**\n   * RTCConfiguration\n   * @see {@link http://dev.w3.org/2011/webrtc/editor/webrtc.html#idl-def-RTCConfiguration}\n   *\n   * Default STUN  TURN-servers\n   * To be overrided from server by 'config' message\n   *\n   * @memberOf BasicConnection\n   * @type {{iceServers: object[]}}\n   */\n  options.rtcConfiguration = options.rtcConfiguration || DEFAULT_RTC_CONFIG;\n\n\n  /** Constants to be used in SDP modifications **/\n  options.STEREO              = options.STEREO              || false;\n  options.audio_send_codec    = options.audio_send_codec    || '';\n  options.audio_receive_codec = options.audio_receive_codec || 'opus/48000';\n\n  /** High or low bandwidth **/\n  options.bandwidth            = options.bandwidth          || BANDWIDTH.HIGH;\n\n  /** Audio/video bandwidth values for low bandwidth **/\n  options.BANDWIDTH_VOICE_LOW = options.BANDWIDTH_VOICE_LOW ||  8;\n  options.BANDWIDTH_VIDEO_LOW = options.BANDWIDTH_VIDEO_LOW || 30;\n\n  /** All events **/\n//  options.onCreateOfferSuccess             = options.onCreateOfferSuccess             || null;\n//  options.onCreateOfferError               = options.onCreateOfferError               || null;\n//  options.onCreateAnswerSuccess            = options.onCreateAnswerSuccess            || null;\n//  options.onCreateAnswerError              = options.onCreateAnswerError              || null;\n\n//  options.onAddStream                = options.onAddStream                || null;\n//  options.onDataChannel              = options.onDataChannel              || null;\n//  options.onIceCandidate             = options.onIceCandidate             || null;\n//  options.onIceConnectionStateChange = options.onIceConnectionStateChange || null;\n//  options.onNegotiationNeeded        = options.onNegotiationNeeded        || null;\n  //options.onRemoveStream             = options.onRemoveStream             || null;\n//  options.onSignallingStateChange    = options.onSignallingStateChange    || null;\n\n  var self = new WRTCPeerConnection(options);\n\n  /**\n   * @memberOf BasicConnection\n   * @property {BasicDTMF} dtmfSender\n   */\n  self.dtmfSender = null;\n\n\n  self.addIceBuffer = function (iceBuffer, connId) {\n    //debug.groupCollapsed('Connection.addIceBuffer()');\n    /** Check if some Ice Candidates with this connId were buffered **/\n    debug.log('Connection.addIceBuffer(): Buffered Ice Candidates count:', iceBuffer.count() );\n\n    for (var i = 0; i < iceBuffer.count(); i++) {\n      var buffered = iceBuffer.getByIndex(i);\n\n      if (buffered.connId === connId) {\n        debug.warn('Connection.addIceBuffer(): Adding buffered Ice Candidate:', buffered.ice,\n          '; connId:', connId);\n        self.addIceCandidate(buffered.ice);\n      }\n    }\n    iceBuffer.removeForConn(connId);\n    //debug.groupEnd();\n    return iceBuffer;\n  };\n\n  /**\n   * @method addIceCandidate\n   * @memberOf BasicConnection\n   * @param {RTCIceCandidate} cand\n   */\n  self.addIceCandidate = function(cand) {\n    debug.groupCollapsed('BasicConnection.addIceCandidate()');\n    // Example of cand:\n    //  RTCIceCandidate { sdpMLineIndex: 0, sdpMid: \"audio\", candidate: \"a=candidate:599991555 1 udp 2122260223 192.168.1.32 44869 typ host generation 0 \" }\n    //\n    var candidateString = cand.candidate;\n    var parsed = parseIceCandidate( candidateString );\n//    if ( (parsed.type === ICE_TYPE.RELAY && CONFIG.TURN.DEBUG.CANDIDATES.TURN    ) ||\n//         (parsed.type !== ICE_TYPE.RELAY && CONFIG.TURN.DEBUG.CANDIDATES.NON_TURN) ) {\n    if ( CONFIG.TURN.DEBUG.BLOCK.indexOf(parsed.type) < 0 ) { /** Not contains in the list to block for the tests **/\n      debug.log('BasicConnection.addIceCandidate(): adding candidateType:\\'' + parsed.type + '\\'; candidateString:' + candidateString);\n      // Adding the candidate which was received from remote side to local RTCPeerConnection\n\n      self.rtcPeerConnection.addIceCandidate(new RTCIceCandidate(cand));\n\n    } else {\n      debug.warn('BasicConnection.addIceCandidate(): skipping candidateType:', parsed.type);\n    }\n    debug.groupEnd();\n  };\n\n  self.setLDesc = self._setLocalDescription;\n  self.setRDesc = self._setRemoteDescription;\n\n  return self;\n};\n\n\n\n\n/**\n * ...\n *\n * @class Connection\n * @param options\n * @returns {{}}\n * @constructor\n */\n\nvar Connection = function( options ) {\n\n  var self;\n\n  var onAddStream = function (mediaStream) {\n    if (self.rvid) {                    /** If this peerConnection have remote video element **/\n      debug.log('Connection.onAddStream(): mediaStream:', mediaStream, '; self.rvid:', self.rvid);\n      self.rvid.attach( mediaStream );  /** then attach the stream to it **/\n      /** No need to call attachingTo() as it is called inside rvid.attach() **/\n      // mediaStream.attachingTo( self.rvid );\n    }\n//    if (options.onAddStream) { options.onAddStream(mediaStream); }\n  };\n\n\n  self = new BasicConnection( options );\n\n\n\n\n  self.onAddStream = onAddStream;\n\n  self.lvid = null; /** Local  Vid (Vid = Container+Video+Overlay+Controls) **/\n  self.rvid = null; /** Remote Vid (Vid = Container+Video+Overlay+Controls) **/\n\n  self.wrtcStats = new WrtcStats(self); /** attach statistics calculation   **/\n  self.wrtcStats.onThreshold = function(thlds) {\n    if (self.rvid) {\n      self.rvid.setQos( thlds.length > 0 );\n    }\n  };\n\n  self.mediaType = options.mediaType;\n  self.connId    = options.connId;\n\n\n\n  var inherited_cleanup = self.cleanup;\n  self.cleanup = function() {\n    inherited_cleanup();\n\n    /** Currently we control the removal 'lvid' during hangup,\n     * so to remove 'lvid' here is an error\n     * 'rvid' can be removed here,\n     * however, there is no need as it is already removed **/\n    if (self.lvid) { /* self.lvid.cleanup(); */ self.lvid = null; }\n    if (self.rvid) { /* self.rvid.cleanup(); */ self.rvid = null; }\n    self.wrtcStats.stop();\n    self.wrtcStats = null;\n  };\n\n  self.showText = function ( text ) {\n    debug.log('Connection.showText()');\n //   if ( remoteUsername ) {\n    var vid = self.rvid;\n      debug.log('Connection.showText(): vid:', vid);\n      if ( vid ) { // For Screen and Video2 there is one-way video, so there is no remote video exists\n        vid.setText( text );// + ' [' + remoteUser.id + ':' + connId + ']' );\n      }\n//    }\n  };\n\n  var REMOTE_SHOW_IDS = false;\n\n  self.showUserInfo = function() {\n    var text = self.remoteUser.name;\n    if (REMOTE_SHOW_IDS) {\n      text += ' [' + self.remoteUser.id + ':' + self.connId + ']';\n    }\n    self.showText(text);\n  };\n\n  return self;\n};\n\nif (typeof module !== 'undefined') {\n  module.exports = Connection;\n}\n\nif (typeof window !== 'undefined') {\n  window.Connection  = Connection;\n}\n",
    "/**\n * Created by alykoshin on 3/21/14.\n */\n\n'use strict';\n\nif ( typeof module !== 'undefined' && typeof require !== 'undefined') {\n  var debug   = require('./../../mylib/utils.js').debug;\n  var Connection = require('./connection.js');\n}\n\n/**\n *    local endpoints              remote endpoints\n * /-------------------\\         /-------------------\\\n *\n *           /---connId1 - - - - connId1---\\\n *           |                             +---userId2\n *           +---connId2 - - - - connId2---/\n * userId1---+\n *           +-- connId3 - - - - connId3---\\\n *           |                             +---userId3\n *           \\-- connId4 - - - - connId4---/\n *\n * [                     <-- [invite]   ]\n *   hello / helloScreen -->\n *                       <-- offer / offerScreen\n *   answer/answerScreen -->\n *                       <-- ice\n *                   ice -->\n *\n */\n\n'use strict';\n\nvar peerConnections = (function() {\n  var that = {};\n\n  Emitter(that);\n\n  /**\n   * Active connections array\n   * @type {{}}\n   */\n  var pcs = {};\n\n  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n  /**   RTCPeerConnection\n   *    RTCPeerConnection   \n   *  -,  HTML -,\n   *      onicecandidate  onaddstream\n   *     \n   *\n   * @param mediaType\n   * @param direction\n   * @param {string} connId\n   * @param localMedia\n   * @param {ConnectionUser} localUserObj\n   * @param {ConnectionUser} remoteUserObj\n   * @returns {Connection}\n   */\n  that.add = function(mediaType, direction, connId, localMedia, localUserObj, remoteUserObj) {\n\n    /**\n     *    ICE-      .\n     *\n     * @param {RTCIceCandidate} cand\n     */\n    function onIceCandidate(cand) {\n      if (cand) {\n        debug.log('pc.onIceCandidate(): cand: \\''+ cand.candidate.replace('\\r\\n', '') +'\\'', cand);\n        //sendIce(remoteUserObj, connId, cand); // remoteUserId    \n        wrtc.sendEvent(MESSAGES.WEBRTC_ICE, remoteUserObj, connId, cand);\n      }\n    }\n\n    function onCreateOfferSuccess(ldesc) {\n      var action;\n      if (mediaType === MEDIA_TYPE.VIDEO) {\n        action = MESSAGES.WEBRTC_OFFER;\n      } else {\n        action = MESSAGES.WEBRTC_OFFER_SCREEN;\n      }\n\n      //sendOffer(action, remoteUserObj, connId, localUserObj, ldesc);\n      wrtc.sendEvent(action, remoteUserObj, connId, ldesc);\n\n      var conn = pcs[connId];\n      conn.addIceBuffer(iceBuffer, connId);\n\n      debug.info('Offer sent. Waiting for the answer from remote...');\n    }\n\n    function onCreateError(error) {\n      debug.error('onCreateError(): error:', error);\n      messageWrtc('Connection error',\n        'Error during establishing connection',\n        'peerConnections.offer/answer()',\n        error);\n    }\n\n    function onCreateAnswerSuccess(ldesc) {\n      debug.log('peerConnections.answer(): success(); sdp: \\n'+ldesc.sdp+' ldesc: ', ldesc);\n      //sendAnswer(MESSAGES.WEBRTC_ANSWER, remoteUserObj, connId, localUserObj, ldesc);\n      wrtc.sendEvent(MESSAGES.WEBRTC_ANSWER, remoteUserObj, connId, ldesc);\n      var conn = pcs[connId];\n      conn.addIceBuffer(iceBuffer, connId);\n      debug.info('Answer sent. Waiting for the media from remote...');\n    }\n\n\n    debug.log('peerConnections.add(): mediaType:', mediaType, '; direction:', direction,\n      '; remoteUserObj:', remoteUserObj, '; connId:', connId, '; localMedia:', localMedia);\n\n    MEDIA_TYPE.check(mediaType);\n\n    var c = new Connection( {\n      rtcConfiguration: rtcConfiguration,\n      bandwidth       : option_bw,\n      mediaType       : mediaType,\n      connId          : connId   // Connection ID is known after Offer/Answer handshake\n      //      onIceCandidate:   onIceCandidate,\n      //      onOfferSuccess:   onOfferSuccess,\n      //      onOfferError:     onOfferError,\n      //      onAnswerSuccess:  onAnswerSuccess,\n      //      onAnswerError:    onAnswerError\n    } );\n\n    c.onCreateOfferSuccess  = onCreateOfferSuccess;\n    c.onCreateOfferError    = onCreateError;\n    c.onCreateAnswerSuccess = onCreateAnswerSuccess;\n    c.onCreateAnswerError   = onCreateError;\n    c.onIceCandidate        = onIceCandidate;\n\n    c._media_was_connected = false;\n\n    c.on('iceConnectionStateChange', function(iceConnectionState, iceGatheringState) {\n      /*\n       * enum RTCIceConnectionState {\n       *   \"new\",\n       *   \"checking\",\n       *   \"connected\",\n       *   \"completed\",\n       *   \"failed\",\n       *   \"disconnected\",\n       *   \"closed\"\n       * };\n       *\n       * enum RTCIceGatheringState {\n       *   \"new\",\n       *   \"gathering\",\n       *   \"complete\"\n       * };\n       */\n      that.emit('iceConnectionStateChange', c, iceConnectionState, iceGatheringState);\n\n      if (iceConnectionState === 'connected' ) { // Connection was established\n        that.emit('media_connect', c);\n\n        if (!c._media_was_connected) {\n          c._media_was_connected = true;\n          that.emit('media_start', c);\n        } else {\n          that.emit('media_continue', c);\n        }\n\n      } else if (iceConnectionState === 'disconnected') { // Media connection was lost\n        that.emit('media_stop', c);\n\n      } else if (iceConnectionState === 'failed') {       // We were not able to establish connection\n        that.emit('media_fail', c);\n      }\n\n    });\n\n    c.on('close', function(conn) { that.emit('close', conn); });\n\n    /** @type {ConnectionUser} */\n    c.localUser  = localUserObj;\n    /** @type {ConnectionUser} */\n    c.remoteUser = remoteUserObj;\n\n    if (direction.forward) {\n      if (localMedia && localMedia.stream) {\n        debug.log('peerConnections.add(): Adding localMedia', localMedia);\n        c.addLocalStream(localMedia.stream);       // Add local stream to the connection\n        c.lvid = localMedia.vid;\n        // debug.log( 'peerConnections.add(): pc.getLocalStreams():', c.peerConnection.getLocalStreams() );\n      } else {\n        debug.warn('peerConnections.add(): no localMedia');\n      }\n    } else {\n      c.lvid = null;\n    }\n\n    if (direction.backward) {\n      c.rvid = remoteVideos.add(mediaType, connId);\n\n      c.showUserInfo(  ); // remoteUserObj.name );\n    } else {\n      c.rvid = null;\n    }\n\n    pcs[connId] = c;\n    return c;\n  };\n\n\n  function addIceBuffer(connId) {\n    var c = pcs[connId];\n    c.addIceBuffer(iceBuffer, connId);\n  }\n\n  that.offer = function(mediaType, offerId, direction, localMedia, localUserObj, remoteUserObj/*, successCb, errorCb*/) {\n    var connId, c;\n    debug.log('peerConnections.offer(): mediaType', mediaType, '; remoteUserObj.id:', remoteUserObj.id, '; localMedia:', localMedia);\n    MEDIA_TYPE.check(mediaType);\n\n    //  Check the number of current videos\n    //      if (remoteVideos.count() >= 2) {\n    //        debug.log('peerConnections.offer(): Offer ignored: Too many videos already active.');\n    //        return;\n    //      }\n\n    connId = genStrId();\n    c = that.add(mediaType, direction, connId, localMedia, localUserObj, remoteUserObj ); //self.find(remoteUserId); // Find\n    //      socket.emit('setConnId', connId); // Set connId for socket from Node.js side to send hangup in the future\n    //    that.successCbOffer = successCb;\n    c.createOffer();\n  };\n\n  that.answer = function(mediaType, direction, connId, localMedia, localUser, remoteUser, rdesc/*, successCb, errorCb*/) {\n    var dir, c;\n    debug.log('peerConnections.answer(s): mediaType', mediaType, '; remoteUser.id:', remoteUser.id, '; connId:', connId, '; localMedia:', localMedia, '; rdesc:', rdesc);\n    MEDIA_TYPE.check(mediaType);\n\n    // for the Answer the direction is opposite\n    // (we assume direction is from offer to answer, but now it is backward\n    dir = {};\n    dir.forward  = direction.backward;\n    dir.backward = direction.forward;\n\n    //    debug.log('!!!!!!!!! answer: add>>>');\n    c = that.add(mediaType, dir, connId, localMedia, localUser, remoteUser );\n\n    c._setRemoteDescription(rdesc);\n    c.createAnswer();\n  };\n\n  /**\n   *  @typedef {{string}} ConnId\n   */\n\n  /**\n   * Removal of RTCPeerConnection:\n   *\n   * @param {ConnId} id\n   */\n  that.delByConnId = function(id) {\n    if ( pcs[id] ) {\n      pcs[id].cleanup();\n      delete pcs[id];  // ...and remove from associative array\n    }\n  };\n\n  /**\n   *\n   * @param {ConnId} id\n   * @returns {*}\n   */\n  that.find = function(id) {\n    return pcs[id];\n  };\n\n  /**\n   *\n   * @param {ConnId} id\n   * @returns {boolean}\n   */\n  that.exists = function(id) {\n    return !!pcs[id];\n  };\n\n  that.addIce = function(connId, ice) {\n    var c = that.find(connId);\n    debug.log('peerConnections.addIce: connId: ' + connId +'; ice: ' + JSON.stringify(ice) );\n    if ( c ) {                      // PeerConnection for this connId is already created\n      c.addIceCandidate(ice);       // Passing it to connection object\n    } else {                        // PeerConnection for this connId is not yet exists\n      iceBuffer.add( connId, ice ); // Storing it to iceBuffer\n    }\n  };\n\n  that.setRDesc = function(connId, desc) {\n    var c = this.find(connId);\n    c.setRDesc(desc);\n  };\n\n  that.setLDesc = function(id, desc) {\n    var c = this.find(id);\n    c.setLDesc(desc);\n  };\n\n  that.onAnswerReceived = function( connId, remoteUser, desc ) {\n    var c = that.find( connId );\n    desc.sdp = sdp_sendonly2sednrecv(desc.sdp);\n    that.setRDesc(connId, desc);\n\n    // Store remote user information\n    c.remoteUser = remoteUser;\n\n    c.showUserInfo();\n  };\n\n  // If specific connection set, hangup only this one\n  that._hangupLocalEndByConnId = function(connId) {\n    debug.log('peerConnections._hangupLocalEndByConnId(): connId:', connId);\n    remoteVideos.delByConnId(connId);\n    that.delByConnId(connId);\n  };\n\n  // 'connId' is not set - Hangup all connections from remote user\n  that._hangupLocalEndByUserId = function(remoteUserId) {\n    for ( var id in pcs ) {   // Iterate through each PeerConnection\n      debug.log('peerConnections._hangupLocalEnd(): iterating: remoteUserId:', remoteUserId);\n      if ( pcs.hasOwnProperty(id) && pcs[id].remoteUser.id === remoteUserId ) { //\n        debug.log('peerConnections._hangupLocalEnd(): found: remoteUserId:', remoteUserId);\n        remoteVideos.delByConnId( id );\n        that.delByConnId( id );\n      }\n    }\n  };\n\n  that._hangupLocalEnd = function(remoteUser, connId) {\n    debug.log('peerConnections._hangupLocalEnd(): ');\n    // If specific connection set, hangup only this one\n    // usually it is initiated by local user\n    if (connId) { that._hangupLocalEndByConnId(connId); }\n    // 'connId' is not set - Hangup all connections from remote user\n    // usually it is initiated by server on remote user websocket disconnect\n    else { that._hangupLocalEndByUserId(remoteUser.id); }\n\n    that.emit('hangup', 'local', remoteUser);\n  };\n\n  that._hangupRemoteEnd = function(remoteUser, connId) {\n    debug.log('peerConnections._hangupRemoteEnd(): ');\n\n    wrtc.sendEvent(MESSAGES.HANGUP, remoteUser, connId, null);\n    that.emit('hangup', 'remote', remoteUser);\n  };\n\n  /**\n   * Hangup was received from remote, we need to release local end\n   *\n   * @param {ConnectionUser} remoteUser\n   * @param {ConnId} connId\n   */\n  that.hangupFromRemote = function(remoteUser, connId) {\n    debug.log('peerConnections.hangupFromRemote(): ');\n\n    that._hangupLocalEnd(remoteUser, connId);\n    that.emit('hangup', 'remote', remoteUser);\n  };\n\n  /**\n   * Hangup initiated by local side, need to release local and remote ends\n   *\n   * @param {ConnectionUser} remoteUser\n   * @param {ConnId} connId\n   */\n  that.hangupFromLocal = function(remoteUser, connId) {\n    debug.log('peerConnections.hangupFromLocal(): ');\n\n    that._hangupLocalEnd(remoteUser, connId);\n    that._hangupRemoteEnd(remoteUser, connId);\n  };\n\n  /**\n   *\n   */\n  that.hangupFromLocalAll = function() {\n    var id;\n    debug.log('peerConnections.hangupFromLocalAll(): ');\n    for ( id in pcs ) {   // will go through all active connections\n      if (pcs.hasOwnProperty(id)) {\n\n        that.hangupFromLocal(pcs[id].remoteUser, pcs[id].connId/*, true*/); /** and hangup each of them **/\n      }\n    }\n  };\n\n  /** iterate through all connections\n   * and hangup all with\n   * - localMediaIndex: \"2\"\n   * - or:  mediaIndex: \"2\"\n   * - mediaType: \"VIDEO\"\n   *\n   * @param mediaType\n   * @param mediaIndex\n   */\n  that.hangupFromLocalByMedia = function(mediaType, mediaIndex) {\n    var pc, id;\n    debug.log('peerConnections.hangupFromLocalByMedia(): mediaType:', mediaType, '; mediaIndex:', mediaIndex);\n    for ( id in pcs ) {   /** will go through all active connections **/\n      if (pcs.hasOwnProperty(id)) {\n        pc = pcs[id];\n        if (pc.lvid) {\n          debug.log('peerConnections.hangupFromLocalByMedia(): pc.lvid: ', pc.lvid);\n          debug.log('peerConnections.hangupFromLocalByMedia(): pc.lvid.mediaType:', pc.lvid.mediaType, '; pc.lvid.mediaIndex:', pc.lvid.mediaIndex);\n          if (pc.lvid.mediaType === mediaType && pc.lvid.mediaIndex == mediaIndex) {\n            debug.log('peerConnections.hangupFromLocalByMedia(): pc.lvid.mediaType:', pc.lvid.mediaType, '; pc.lvid.mediaIndex:', pc.lvid.mediaIndex);\n\n            that.hangupFromLocal(pc.remoteUser, pc.connId/*, true*/); /** and hangup each of them **/\n          }\n        }\n      }\n    }\n  };\n\n  /**\n   *\n   * @returns {number}\n   */\n  that.count = function() {\n    return Object.size(pcs);\n  };\n\n  /**\n   * To give access to PeerConnection array\n   *\n   * @returns {{}}\n   */\n  that.pcs = function() {\n    return pcs;\n  };\n\n  return that;\n}());\n\nif (typeof module !== 'undefined') {\n  module.exports = peerConnections;\n}\n\nif (typeof window !== 'undefined') {\n  window.peerConnections  = peerConnections;\n}\n",
    "/**\n * Created by alykoshin on 9/3/14.\n */\n\n\"use strict\";\n\nif ( typeof module !== 'undefined' && typeof require !== 'undefined') {\n  var debug   = require('./../../mylib/utils.js').debug;\n  var _RTCPeerConnection = require('./_RTCPeerConnection.js');\n}\n\n/**\n * Medium-level wrapper for RTCPeerConnection\n *\n * @class LWRTCPeerConnection\n * @constructor\n * @param {{}} rtcConfiguration\n */\nvar LWRTCPeerConnection = function ( rtcConfiguration ) {\n\n  /**\n   * @type {LWRTCPeerConnection}\n   * @private\n   */\n  var self = new _RTCPeerConnection(rtcConfiguration);\n\n  /**\n   * @memberOf LWRTCPeerConnection\n   * @type {BasicDTMF}\n   */\n  self.dtmfSender = null;\n\n  self.onAddStream                = null;\n//  self.onDataChannel              = null;\n  self.onIceCandidate             = null;\n//  self.onIceConnectionStateChange = null;\n  //self.onNegotiationNeeded        = null;\n  ///self.onRemoveStream             = null;\n  self.onSignalingStateChange    = null;\n\n  /** RTCPeerConnection event handling **/\n\n  self.on('_addstream', function(ev) {\n    var mediaStream = new MediaStreamView( ev.stream );\n    self.dtmfSender = new BasicDTMF(self.rtcPeerConnection);\n    if ( self.onAddStream ) { self.onAddStream(mediaStream); }\n  });\n\n  //self.on('_datachannel', function(ev) {\n  //  if (ev) {\n  //    debug.log('LWRTCPeerConnection.ondatachannel():', ev);\n  //    //if ( self.onDataChannel ) { self.onDataChannel(); }\n  //  }\n  //});\n\n  self.on('_icecandidate', function(ev) {\n    /**\n     * Fix for Temasys 0.8.794 bug\n     * More details: https://groups.google.com/d/msg/temasys-discuss-webrtcplugin/jgUatfO1pDA/n1beMrml9AIJ\n     *\n     * @param {RTCIceCandidate} origCand\n     * @returns {RTCIceCandidate}\n     */\n    function FixTemasys_0_8_794 (origCand) {\n      var resultCand;\n      if (origCand) {\n        resultCand = {\n          candidate:     origCand.candidate,\n          sdpMid:        origCand.sdpMid,\n          sdpMLineIndex: origCand.sdpMLineIndex\n        };\n      } else {\n        resultCand = null;\n      }\n      return resultCand;\n    }\n\n    /**\n     *\n     * @type {RTCIceCandidate}\n     */\n    var cand = ev.candidate;\n    //\n    // Example of cand:\n    //  RTCIceCandidate { sdpMLineIndex: 0, sdpMid: \"audio\", candidate: \"a=candidate:599991555 1 udp 2122260223 192.168.1.32 44869 typ host generation 0 \" }\n    //\n    cand = FixTemasys_0_8_794( cand );\n\n    if (cand) {\n      debug.log('LWRTCPeerConnection.onicecandidate(): ev.candidate.candidate: \"'+\n        cand.candidate.replace('\\r\\n', '') + '\"', cand);\n      if ( self.onIceCandidate ) { self.onIceCandidate(cand); }\n    }\n  });\n\n  /**\n   * @param ev\n   */\n  self.on('_iceconnectionstatechange', function(ev) {\n    // ev.target is undefined in IE10+Temasys\n    if (self.rtcPeerConnection) { // On IE with Temasys we can get situation when event fires, however, that or that.pc is already not exists\n      debug.log('pc.on(\\'_iceconnectionstatechange\\'):',\n        '; iceConnectionState:', ev.target.iceConnectionState,\n        '; iceGatheringState:',  ev.target.iceGatheringState);\n    }\n    //if ( self.onIceConnectionStateChange ) {\n    //  self.onIceConnectionStateChange(self.iceConnectionState, self.iceGatheringState);\n    //}\n    self.emit('iceConnectionStateChange', ev.target.iceConnectionState, ev.target.iceGatheringState);\n  });\n\n  //self.on('_negotiationneeded', function(ev) {\n  //  if (self.onNegotiationNeeded ) { self.onNegotiationNeeded(ev); }\n  //});\n\n  //self.on('_removestream', function(ev) {\n  //  if ( self.onRemoveStream ) { self.onRemoveStream(ev); }\n  //});\n\n  self.on('_signalingstatechange', function(ev) {\n    // ev.target is undefined in IE10+Temasys\n    if (/*self &&*/ self.rtcPeerConnection) { /** On IE with Temasys we can get situation when event fires, however, that.pc is already not exists **/\n    debug.log('pc.signalingstatechange():',\n      'signalingSate:', ev.target.signalingState,\n      '; ev.target:', ev.target);\n    }\n\n    if ( self.onSignalingStateChange ) { self.onSignalingStateChange(ev.target.signalingState); }\n    self.emit('signalingStateChange', ev.target.signalingState);\n  });\n\n  return self;\n\n};\n\nif (typeof module !== 'undefined') {\n  module.exports = LWRTCPeerConnection;\n}\n\nif (typeof window !== 'undefined') {\n  window.LWRTCPeerConnection = LWRTCPeerConnection;\n}\n",
    "/**\n * Created by alykoshin on 9/3/14.\n */\n\n'use strict';\n\nif ( typeof module !== 'undefined' && typeof require !== 'undefined') {\n  var debug   = require('./../../mylib/utils.js').debug;\n  var LWRTCPeerConnection = require('./lwrtcPeerConnection.js');\n}\n\n/**\n * Wrapper for RTCPeerConnection\n *\n * @class WRTCPeerConnection\n * @constructor\n * @param {{\n *   rtcConfiguration: {},\n *   audio_send_codec: String,\n *   audio_receive_codec: String,\n *   STEREO: {boolean},\n *   bandwidth: {string},\n *   BANDWIDTH_VOICE_LOW: number,\n *   BANDWIDTH_VIDEO_LOW: number\n * }} options\n */\nvar WRTCPeerConnection = function ( options ) {\n\n  /**\n   * @type {WRTCPeerConnection}\n   * @private\n   */\n  var self = LWRTCPeerConnection(options.rtcConfiguration);\n\n  /**\n   * @memberOf WRTCPeerConnection\n   * @type {function}\n   */\n  self.onIceCandidate = null;\n\n  function preprocessDescription(description) {\n    var sdp = description.sdp;\n    if (options.STEREO) {\n      sdp = addStereo(sdp);\n    }\n\n\n    // options.audio_send_codec = 'PCMA/8000';\n\n\n    if (options.audio_send_codec) {\n      sdp = preferAudioCodec(sdp, options.audio_send_codec);\n    }\n    sdp = sdp_sendonly2sednrecv(sdp);\n    sdp = sdp_recvonly2sednrecv(sdp);\n    if (options.bandwidth === BANDWIDTH.LOW) {\n      sdp = setBandwidth(sdp, options.BANDWIDTH_VOICE_LOW, options.BANDWIDTH_VIDEO_LOW);\n    }\n    description.sdp = sdp;\n    return description;\n  }\n\n  self.on('_setLocalDescription',  preprocessDescription);\n  self.on('_setRemoteDescription', preprocessDescription);\n\n  /**\n   * @memberOf WRTCPeerConnection\n   * @param {RTCSessionDescription} localDescription\n   * @private\n   */\n  self.on('_createOfferSuccess', function(localDescription) {\n    self._setLocalDescription(localDescription);\n    self.addIceBuffer(iceBuffer);\n    if (self.onCreateOfferSuccess) { self.onCreateOfferSuccess(localDescription); }\n  });\n\n  /**\n   * @memberOf WRTCPeerConnection\n   * @param error\n   * @private\n   */\n  self.on('_createOfferError', function(error) {\n    debug.error('WRTCPeerConnection.createOffer(): _onOfferError(): ' + errorToString(error));\n    if (self.onOfferError) { self.onOfferError(error); }\n  });\n\n  /**\n   * @memberOf WRTCPeerConnection\n   * @param localDescription\n   * @private\n   */\n  self.on('_createAnswerSuccess', function(localDescription) {\n    self._setLocalDescription(localDescription);\n    self.addIceBuffer(iceBuffer);\n    if (self.onCreateAnswerSuccess) { self.onCreateAnswerSuccess(localDescription); }\n  });\n\n  /**\n   * @memberOf WRTCPeerConnection\n   * @param error\n   * @private\n   */\n  self.on('_createAnswerError', function(error) {\n    debug.error('WRTCPeerConnection.createAnswer(): onAnswerError(): ' + errorToString(error));\n    if (self.onCreateAnswerError) { self.onCreateAnswerError(error); }\n  });\n\n  return self;\n\n};\n\nif (typeof module !== 'undefined') {\n  module.exports = WRTCPeerConnection;\n}\n\nif (typeof window !== 'undefined') {\n  window.WRTCPeerConnection = WRTCPeerConnection;\n}\n",
    "/**\n * Created by alykoshin on 9/23/14.\n */\n\n'use strict';\n\nif ( typeof module !== 'undefined' && typeof require !== 'undefined') {\n  var debug   = require('./../../mylib/utils.js').debug;\n}\n\nvar BasicContainer = function(/*parentId, containerId*/) {\n  var that = {};\n\n  /**\n   * Whether the container is maximized to full size of its parent element\n   * @type {boolean}\n   */\n  that.maximized = false;\n  that.parentElement = null;\n\n//  that.parentId    = parentId;\n//  that.containerId = containerId;\n\n  that.init = function() {\n//    var div = document.createElement('div');\n//    parent.appendChild()\n    // Nothing to do\n  };\n\n  that.addHTMLByTemplateSource = function(parentElement, templateSource, context) {\n    //debug.log('Vid.addHTMLByTemplateSource(): parentElement:',parentElement, '; templateSource:', templateSource, '; context:', context);\n    var result = null;\n    try {\n      that.template = Handlebars.compile(templateSource);\n      var html      = that.template(context);\n\n      /** Create new DIV, set its content to the result of applied template and append to parent **/\n      var newElement = document.createElement('div');\n      newElement.className=\"wrtcContainerWrapper\";\n      newElement.innerHTML = html;\n      // Line below adds unneeded div element in hierarchy\n      parentElement.appendChild( newElement );\n\n      /** Below is wrong way as it modifies all the HTML, including previously added elements **/\n      //parentElement.innerHTML += html;\n\n      that.parentElement = parentElement;\n\n      result = html;\n    } catch (error) {\n      debug.error('Error: \\''+error.toString()+'\\'');\n    }\n    return result;\n    //debug.log('BasicContainer.addHTMLByTemplateSource(): result:', result);\n  };\n\n  /**\n   *\n   * @param parentElement              - Parent DOM Element which will hold this Container\n   * @param {String} templateElementId - Handlebars template elementId in HTML file\n   * @param {Object} context           - Data to apply to the template\n   */\n  that.addHTMLByTemplateId = function(parentElement, templateElementId, context) {\n    var template = document.getElementById(templateElementId).innerHTML;\n    var result   = that.addHTMLByTemplateSource(parentElement, template, context);\n    // debug.log('BasicContainer.addHTMLByTemplateId(): result:', result);\n  };\n\n  /**\n   * Repositioning\n   */\n  var SIDE = Enum( {\n    LEFT:   'left',\n    RIGHT:  'right',\n    TOP:    'top',\n    BOTTOM: 'bottom'\n  } );\n\n  var CORNER = Enum( {\n    LEFT_TOP:     { SIDE1: SIDE.LEFT,  SIDE2: SIDE.TOP    },\n    RIGHT_TOP:    { SIDE1: SIDE.RIGHT, SIDE2: SIDE.TOP    },\n    RIGHT_BOTTOM: { SIDE1: SIDE.RIGHT, SIDE2: SIDE.BOTTOM },\n    LEFT_BOTTOM:  { SIDE1: SIDE.LEFT,  SIDE2: SIDE.BOTTOM }\n  } );\n\n  that.reset = function() {\n    // Dirty fix to remove fixed size\n\n    var dimensions = ['left', 'right', 'top', 'bottom', 'height', 'width'];\n\n    var htmlContainer = that.getContainer(); // document.getElementById(that.containerId); //\n    assert(htmlContainer, 'BasicContainer.htmlContainer: ' + htmlContainer);\n\n    for (var d in dimensions) {\n      if (dimensions.hasOwnProperty(d)) {\n        htmlContainer.style[dimensions[d]] = null;//'none';\n      }\n    }\n    debug.log('BasicContainer.reset: htmlContainer.style:', htmlContainer.style);\n  };\n\n  that.getParentSize = function() {\n    return {\n      height: that.parentElement.clientHeight,\n      width:  that.parentElement.clientWidth\n    };\n  };\n\n  that.getDocumentSize = function() {\n    var result = {};\n    /*    if (document.body && document.body.offsetWidth) {\n     result.width  = document.body.offsetWidth;\n     result.height = document.body.offsetHeight;\n     } else if (document.compatMode === 'CSS1Compat' &&\n     document.documentElement &&\n     document.documentElement.offsetWidth ) {\n     result.width  = document.documentElement.offsetWidth;\n     result.height = document.documentElement.offsetHeight;\n     } else if (window.innerWidth && window.innerHeight) {\n     result.width  = window.innerWidth;\n     result.height = window.innerHeight;\n     }*/\n\n    /** http://stackoverflow.com/questions/3437786/how-to-get-web-page-size-browser-window-size-screen-size-in-a-cross-browser-wa **/\n    var w = window,\n      d = document,\n      e = d.documentElement,\n      g = d.getElementsByTagName('body')[0];\n    result.width  = w.innerWidth || e.clientWidth || g.clientWidth;\n    result.height = w.innerHeight|| e.clientHeight|| g.clientHeight;\n//    debug.log('getDocumentSize(): result:', result);\n    return result;\n  };\n\n  that.setPos = function(eCorner, fX, fY) {\n    try {\n      var iX = Math.round(fX); // Math.floor(floatX);\n      var iY = Math.round(fY); // Math.floor(fY);\n      // assert(SIDE.exist(sSide1) && SIDE.exist(sSide2), 'BasicContainer.setPos(): Invalid Side' +\n      //  ': sSide1: \\'' + sSide1 + '\\'; sSide2: \\''+sSide2+'\\'');\n      //debug.log('BasicContainer.setPos(): sSide1:',sSide1,'; iX:',iX,'; sSide2:',sSide2,'; iY:',iY);\n\n      var htmlContainer = that.getContainer(); // document.getElementById(that.containerId); //\n      assert(htmlContainer, 'BasicContainer.htmlContainer: ' + htmlContainer);\n\n      htmlContainer.style[eCorner.SIDE1] = iX + 'px';\n      htmlContainer.style[eCorner.SIDE2] = iY + 'px';\n    } catch (error) {\n      debug.warn('BasicContainer.setPos(): '+error.toString());\n    }\n  };\n\n  that.setLeftTop = function (x, y) {\n    that.setPos(CORNER.LEFT_TOP, x,   y);\n  };\n\n  that.setRightTop = function (x, y) {\n    that.setPos(CORNER.RIGHT_TOP, x, y);\n  };\n\n  that.setLeftBottom = function (x, y) {\n    that.setPos(CORNER.LEFT_BOTTOM, x, y);\n  };\n\n  that.setRightBottom = function (x, y) {\n    that.setPos(CORNER.RIGHT_BOTTOM, x, y);\n  };\n\n  that.setXY = that.setLeftTop;\n\n  that.setZ = function (zIndex) {\n    if (zIndex) {\n      var htmlContainer = that.getContainer(); //document.getElementById(prefix + 'Container_' + video.connId);\n      assert(htmlContainer, 'BasicContainer.setZ(): htmlContainer: \\'', htmlContainer, '\\'');\n\n      htmlContainer.style['z-index'] = zIndex;\n    }\n  };\n\n  that.setSize = function(fWidth, fHeight) {\n    try {\n      var iWidth  = Math.round(fWidth)  /*+ 1*/; // Math.ceil(fWidth);\n      var iHeight = Math.round(fHeight) /*+ 1*/; // Math.ceil(fHeight);\n      // debug.log('BasicContainer.setSize(): iWidth:', iWidth, '; iHeight:', iHeight);\n\n      var htmlContainer = that.getContainer(); /** Container - parent element for Video, overlay, controls **/\n      assert(htmlContainer, 'BasicContainer.setSize(): htmlContainer: ' + htmlContainer);\n\n      /** This reposition both htmlContainer and video OK in Chrome & FF,\n       *  however not in IE10+Temasys                                 */\n      htmlContainer.style.width  = iWidth  + 'px';\n      htmlContainer.style.height = iHeight + 'px';\n    } catch (error) {\n      debug.warn('BasicContainer.setSize(): Error: '+error.toString());\n    }\n  };\n\n  that.getMaximizeSize = that.getParentSize; // For normal container it is size of parent. Container Holder will overrides it to getDocumentSize\n  //debug.debug('that.getMaximizeSize:', that.getMaximizeSize);\n\n  that.maximize = function() {\n    //debug.log('BasicContainer.maximizeChild(): that.getMaximizeSize:', that.getMaximizeSize);\n    that.maximized = true;\n    var size = that.getMaximizeSize();\n\n    that.setXY(0, 0);\n    that.setSize(size.width, size.height);\n  };\n\n  that.restore = function() {\n    //debug.log('BasicContainer.maximizeChild(): that.getMaximizeSize:', that.getMaximizeSize);\n    if (that.maximized) {\n      that.maximized = false;\n    }\n  };\n\n  var DIST_FROM_BORDER = 20;\n\n  /** Aux function for drag-and-drop.\n   * To be replaced when variable number of Local Videos will be implemented **/\n  that.toNearestCorner = function(x, y) {\n    var docSize = that.vid.getDocumentSize();\n    var docCenter = {\n      x: docSize.width  / 2,\n      y: docSize.height / 2\n    };\n    debug.log('BasicContainer.toNearestCorner: x:', x, '; y:', y, '; docCenter.x:', docCenter.x, '; docCenter.y:', docCenter.y );\n    if (x < docCenter.x) {\n      if (y < docCenter.y) { that.setLeftTop(   DIST_FROM_BORDER, DIST_FROM_BORDER); }\n      else                 { that.setLeftBottom(DIST_FROM_BORDER, DIST_FROM_BORDER); }\n    } else {\n      if (y < docCenter.y) { that.setRightTop(   DIST_FROM_BORDER, DIST_FROM_BORDER); }\n      else                 { that.setRightBottom(DIST_FROM_BORDER, DIST_FROM_BORDER); }\n    }\n  };\n\n  return that;\n};\n\nif (typeof module !== 'undefined') {\n  module.exports = BasicContainer;\n}\n\nif (typeof window !== 'undefined') {\n  window.BasicContainer  = BasicContainer;\n}\n",
    "/**\n * Created by alykoshin on 6/30/14.\n */\n\n'use strict';\n\nif ( typeof module !== 'undefined' && typeof require !== 'undefined') {\n  var debug   = require('./../../mylib/utils.js').debug;\n  var BasicContainer   = require('./basicContainer.js');\n}\n\nvar ALIGN = Enum({\n  TOP:   'TOP',\n  RIGHT: 'RIGHT',\n  BOTTOM:'BOTTOM',\n  LEFT:  'LEFT',\n  CENTER: 'CENTER'\n});\nvar LOCAL_OR_REMOTE = Enum({\n  LOCAL:  'LOCAL',\n  REMOTE: 'REMOTE'\n});\nvar CLASS_LOCAL_OR_REMOTE = {};\nCLASS_LOCAL_OR_REMOTE[LOCAL_OR_REMOTE.LOCAL]  = 'Local';\nCLASS_LOCAL_OR_REMOTE[LOCAL_OR_REMOTE.REMOTE] = 'Remote';\n\nvar MEDIA_TYPE = Enum({\n  VIDEO:  'VIDEO',\n  SCREEN: 'SCREEN'\n});\n\nvar CLASS_VIDEO_OR_SCREEN = {};\nCLASS_VIDEO_OR_SCREEN[MEDIA_TYPE.VIDEO]  = 'Video';\nCLASS_VIDEO_OR_SCREEN[MEDIA_TYPE.SCREEN] = 'Screen';\n\nvar PREFIX_BASE = 'wrtc';\nvar RESIZE_TIMEOUT = ONE_SECOND_MSEC / 2; // 100; // Milliseconds\n\n\n//var POSTER_NONE = 'none';\n\n\n\n\n\n\nvar Vid = function(parentHolder, localOrRemote, mediaType, mediaIndex) {\n  MEDIA_TYPE.check(mediaType);\n  LOCAL_OR_REMOTE.check(localOrRemote);\n\n  var that = new BasicContainer();\n\n  that = Attachable(that);\n\n\n  that.parent = parentHolder;\n  that.stream = null;\n\n  that.mediaType  = mediaType;\n  that.mediaIndex = mediaIndex;\n  that.vidId      = mediaType + '_' + mediaIndex;\n\n  that.onStreamResize = null;  // Callback for stream resize\n\n//  that.showActive   = true;  // null;\n//  that.showInactive = false; //null;\n//  that.poster       = null;\n\n  var prefix = PREFIX_BASE + CLASS_LOCAL_OR_REMOTE[localOrRemote];\n\n\n  var super_init = that.init;\n  that.init = function() {\n    super_init();\n\n    debug.groupCollapsed('Vid.init()');\n\n    // Disable browser/WebRTC specific options for user\n    var i, list;\n\n    // Check if current video element is Temasys\n    if ( get_temasys_version() ) {\n      // Need to disable/hide some options:\n      // 1. Speaker Mute\n      list = document.getElementsByClassName('wrtcSpeaker');\n      for ( i = 0; i < list.length; i++ ) {\n        elementHide( list[i] );\n      }\n    }\n\n    // Check version of IE\n    if (get_browser() === 'MSIE') { //} && get_browser_version() < 11) {\n      // Need to disable/hide some options:\n      // 1. FullScreen\n      list = document.getElementsByClassName('wrtcFullScreen');\n      for ( i = 0; i < list.length; i++ ) {\n        elementDisable( list[i] );\n      }\n    }\n    debug.groupEnd();\n  };\n\n\n  that.createHtml = function(mediaType, mediaIndexOrConnId, vidId, localOrRemote) {\n    var TEMPLATE_ID = 'wrtcViewTemplate';\n    var htmlContainer;\n\n    assert(mediaType in MEDIA_TYPE, 'Vid.createHtml: Invalid mediaType: ' + mediaType);\n\n    // !!! Parameter infoText was removed\n    //var infoText    = '';\n    // !!!\n\n\n    debug.log('Vid.createHtml(): localOrRemote:', localOrRemote);\n\n    htmlContainer   = that.addHTMLByTemplateId(that.parent.holder, TEMPLATE_ID, {\n      infoText           : '', // infoText,\n      vidId              : vidId,\n      connId             : mediaIndexOrConnId,\n      prefix             : that.prefix,\n      autoplay           : true,\n      // Mute local videos to prevent noise\n      // Now they are muted automatically - need to test\n      //\n      muted              : (localOrRemote === LOCAL_OR_REMOTE.LOCAL) ? 'muted=\"muted\"' : '',\n      classVideoOrScreen : CLASS_VIDEO_OR_SCREEN[mediaType],\n      classLocalOrRemote : CLASS_LOCAL_OR_REMOTE[localOrRemote]\n    } );\n\n    return htmlContainer;\n  };\n\n\n  var super_setSize = that.setSize;\n  that.setSize = function(width, height) {\n    try {\n      // This reposition both htmlContainer and htmlVideo OK in Chrome & FF,\n      // however not in IE10+Temasys\n      super_setSize(width, height);\n\n      width  = Math.round(width) /* + 1*/; // Math.ceil(width);\n      height = Math.round(height) /*+ 1*/; // Math.ceil(height);\n\n      var htmlVideo = that.getVideo();     // HTML Video Element\n\n\n      if ( htmlVideo && htmlVideo.isTemWebRTCPlugin /* get_temasys_version() &&*/ /*&& htmlVideo.tagName === 'OBJECT' */ ) {\n\n\n        /** Temasys plugin is visible as HTML element 'OBJECT',\n         *  ? however, at init it looks like VIDEO(!?)\n         *  ? htmlVideo.type === \"application/x-temwebrtcplugin\"\n         *\n         * htmlVideo.isTemWebRTCPlugin() seems to be more reliable method\n         * For IE10+Temasys htmlVideo inside htmlContainer does not resizes automatically\n         * to fit into it\n         */\n        htmlVideo.style.width  = width  + 'px';  // + 4\n        htmlVideo.style.height = height + 'px'; // + 4\n//      console.log('Vid.setSize():',// videoId:', //videoId,\n//        '; htmlVideo.style.width:',  htmlVideo.style.width,\n//        '; htmlVideo.style.height:', htmlVideo.style.height);\n      }\n    } catch (error) {\n      debug.warn('Vid.setSize(): '+error.toString());\n    }\n\n  };\n\n  that.setTextById = function(elementId, text) {\n    try {\n      var element = document.getElementById(elementId);\n      element.innerHTML = text;\n    } catch (error) {\n      debug.warn('Vid.setText(): '+error.toString());\n    }\n  };\n\n  that.setTextLeft = function(text) {\n    that.setTextById ( prefix+'Text_'   + that.vidId +'_Left', text );\n  };\n\n  that.setTextRight = function(text) {\n    that.setTextById ( prefix+'Text_'   + that.vidId +'_Right', text );\n  };\n\n  that.setQos = function(isOn) {\n    //debug.log('that.setQos(): isOn:', isOn);\n    var cont = that.getContainer();\n    var btns = cont.getElementsByClassName('wrtcQosBtn');\n    var i;\n    //debug.log('that.setQos(): cont:', cont, '; btns:', btns);\n\n    window.btns = btns;\n\n    for (i=0; i<btns.length; i++) {\n      isOn ? elementOn(btns[i]) : elementOff(btns[i]);\n    }\n  };\n\n  that.setText = that.setTextLeft;\n\n  /*********************************************************************************************************************\n   * Attach Media Stream to Video Element\n   *\n   * @param {MediaStreamView} mediaStream\n   * @returns {*}\n   */\n  that.attach = function(mediaStream) {\n    if (!mediaStream) { debug.warn('Vid.attach(): mediaStream:', mediaStream); return; }\n\n//    try {\n    that.stream = mediaStream; /** Store mediaStream **/\n\n    var htmlVideo = that.getVideo();\n    debug.log('Vid.attach(): htmlVideo:', htmlVideo, '; mediaStream:', mediaStream);\n\n    // Attach htmlVideo stream to HTML htmlVideo element\n    if (get_temasys_version()) {\n      //debug.log('Vid.attach(): temasys branch 1' +\n      //  ': htmlVideo:', htmlVideo.innerHTML,\n      //  '; mediaStream.stream', mediaStream.stream);\n\n      // Temasys plugin attach\n      // https://temasys.atlassian.net/wiki/display/TWPP/How+to+integrate+the+plugin+with+your+website\n      //\n      htmlVideo = attachMediaStream(htmlVideo, mediaStream.stream);\n\n      //debug.log('Vid.attach(): temasys branch 2');\n\n    } else { // Default WebRTC attach\n      attachMediaStream(htmlVideo, mediaStream.stream);\n    }\n\n    that.attachTo(mediaStream);\n//    mediaStream.attachingTo(that);\n    //debug.log('Vid.attach(): temasys branch 3');\n\n    // Hook to stream resize\n\n      // debug.debug('Vid('+mediaType+'/'+mediaIndex+').attach(): that.onStreamResize: 2 ', (that.onStreamResize ? 'assigned' : 'not assigned') );\n    hookStreamResize();\n    //debug.log('Vid.attach(): temasys branch 4');\n//    } catch (error) {\n//      debug.error('Error: \\''+error.toString()+'\\'');\n//    }\n    return htmlVideo;\n  };\n\n  that.detach = function() {\n    var htmlVideo = that.getVideo();\n    debug.log('Vid.detach(): htmlVideo:', htmlVideo, '; that.stream:', that.stream);\n\n    if (htmlVideo) {\n      detachMediaStream( htmlVideo );\n    }\n    if (that.stream) {\n      //that.stream.detachingFrom( that );\n      //that.stream = null;\n      that.detachFrom(that.stream);\n    }\n  };\n\n  /**\n   * ! Moved to CSS !\n   * Show video stream resolution in top-left corner i.e. 640x480\n   * @type {boolean}\n   */\n  //var SHOW_DIMENSIONS = false;\n\n  /**\n   *  Catch stream resize event (including IE workaround)\n   *  when new stream arrives, we need to get its width/height to resize later htmlContainer\n   */\n  function hookStreamResize() {\n    var oldWidth  = 0;\n    var oldHeight = 0;\n    try {\n      //debug.debug('Vid('+mediaType+'/'+mediaIndex+').hookStreamResize(): that.onStreamResize: 1 ', ( that.onStreamResize ? 'assigned' : 'not assigned') );\n\n      // Previosly we checked if we are using Temasys/IE10 plugin or Firefox,\n      // but now we try to use both ways simultaneously to react on stream resize\n      //\n//      if ( get_temasys_version() /*|| get_browser()==='Firefox'*/) {\n//        debug.info('remoteVideos.attachStream(): We are using Temasys plugin or Firefox, ' +\n//          'need workaround as it does not support all the video events like \"playing\", \"play\" etc');\n      var checkInterval = null;\n\n      /** Workaround fo IE10+Temasys and Firefox **/\n      checkInterval = setInterval( function() {\n        var v  = that.getVideo();\n        // If video element does not exists, stop checking\n        // (most probably, video session was finished)\n        if ( !v ) {\n          clearInterval(checkInterval);\n          return;\n        }\n        var width  = that.getVideoWidth();\n        var height = that.getVideoHeight();\n\n        if (oldWidth !== width && oldHeight !== height) {\n\n//          if (width && height) {\n//            debug.info('Vid('+mediaType+'/'+mediaIndex+').hookStreamResize(): Video size: ' + width +'x' + height +'.' );\n//          } else {\n//            debug.info('Vid('+mediaType+'/'+mediaIndex+').hookStreamResize(): Video size: unknown.' );\n//          }\n          var dimensions = (width && height) ? width +'x' + height : 'unknown';\n\n          debug.info('Vid('+mediaType+'/'+mediaIndex+').hookStreamResize(): checkInterval(): Video size: ' + dimensions +'.' );\n\n          oldWidth  = width;\n          oldHeight = height;\n\n          that.setVisible();\n\n          // Moved to CSS\n          //if (SHOW_DIMENSIONS) {\n            that.setTextRight(dimensions);\n          //}\n          if (that.onStreamResize) { that.onStreamResize(width, height); }\n        }\n      }, RESIZE_TIMEOUT );\n//      } else {\n      // we are nor using Temasys plugin nor Firefox (does it really works for Firefox ??? )\n      //  then it's probably Chrome and we can catch video events correctly\n      //\n      //  http://webrtchacks.com/how-to-figure-out-webrtc-camera-resolutions\n      //  webrtcH4cKS: ~ How to Figure Out WebRTC Camera Resolutions\n      var htmlVideo = that.getVideo();\n      htmlVideo.addEventListener('playing', function () {\n\n        var width  = that.getVideoWidth();\n        var height = that.getVideoHeight();\n\n        var dimensions = (width && height) ? width +'x' + height : 'unknown';\n\n        debug.info('Vid('+mediaType+'/'+mediaIndex+').hookStreamResize(): addEventListener: playing: Video size: ' + dimensions +'.' );\n\n        that.setVisible();\n        // Moved to CSS\n        //if (SHOW_DIMENSIONS) {\n          that.setTextRight(dimensions);\n        //}\n        if (that.onStreamResize) { that.onStreamResize(width, height); }\n      });\n//      }\n    } catch (error) {\n      debug.error('Error: \\''+error.toString()+'\\'');\n    }\n  }\n\n  /**\n   *\n   * @param {string} align\n   * @param leftX\n   * @param topY\n   * @param rightX\n   * @param bottomY\n   * @param z\n   */\n  that.positionVideoInRect = function(align, leftX, topY, rightX, bottomY, z) { //availW, availH) {\n    ALIGN.check(align);\n\n    var videoH = that.getVideoHeight();\n    var videoW = that.getVideoWidth();\n\n    videoH = videoH ? videoH : DEFAULT_VIDEO_SIZE.height;\n    videoW = videoW ? videoW : DEFAULT_VIDEO_SIZE.width;\n\n    var\n      availW = rightX - leftX,\n      availH = bottomY - topY;\n    var\n      coeffW = availW / videoW,\n      coeffH = availH / videoH;\n\n    var w, h;\n    if (coeffW > coeffH) {\n      w = videoW * coeffH;\n      h = videoH * coeffH;\n    } else {\n      w = videoW * coeffW;\n      h = videoH * coeffW;\n    }\n\n    var x, y;\n    if      (align === ALIGN.LEFT  )  { x = 0; }\n    else if (align === ALIGN.CENTER)  { x = availW/2 - w/2; }\n    else  /* align === ALIGN.RIGHT */ { x = availW - w; }\n    y = availH/2 - h/2;\n\n    var absX, absY;\n    absX = leftX + x;\n    absY = topY  + y;\n\n    that.setSize( w,    h);\n    that.setXY(   absX, absY);\n    that.setZ(z);\n  };\n\n  /**\n   * Overrides BasicContainer.maximize to adjust video size according not only to parent's dimensions,\n   * but to video too\n   */\n  that.maximize = function() {\n    //debug.log('BasicContainer.maximizeChild(): that.getMaximizeSize:', that.getMaximizeSize);\n    that.maximized = true;\n    var size = that.getMaximizeSize();\n    that.positionVideoInRect(ALIGN.CENTER, 0,0,size.width, size.height)\n  };\n\n  that.cleanup = function() {\n    that.detach();\n\n    //that.stream = null;\n    var htmlVideo   = that.getVideo();\n    //console.log('Vid.cleanup(): htmlVideo:', htmlVideo);\n    //if (htmlVideo) { htmlVideo.src = ''; }\n\n    var htmlOverlay   = that.getOverlay();\n    //console.log('Vid.cleanup(): htmlOverlay:', htmlOverlay);\n\n    var htmlContainer = that.getContainer();\n    //console.log('Vid.cleanup(): htmlContainer:', htmlContainer);\n\n    // There is one div between VideoHolder and VideoContainer\n    var htmlParentDiv   = htmlContainer.parentNode;\n    var htmlVideoHolder = htmlParentDiv.parentNode;\n\n    if (htmlContainer) {\n      if (htmlVideo)   { htmlContainer.removeChild(htmlVideo);   } // Remove Video\n      if (htmlOverlay) { htmlContainer.removeChild(htmlOverlay); } // Remove Overlay\n      if (htmlParentDiv) {\n        htmlParentDiv.removeChild(htmlContainer);   // Remove Container\n        if (htmlVideoHolder) {\n          htmlVideoHolder.removeChild(htmlParentDiv); // Remove <div>\n        }\n      }\n    }\n  };\n\n  that.getContainer = function() {\n    var elementId = prefix + 'Container_' + that.vidId;\n    var htmlElement = document.getElementById(elementId);\n    //if (!htmlElement) { debug.warn ('getContainer(): Error: htmlElement is empty:', htmlElement); }\n    return htmlElement;\n  };\n\n  that.getOverlay = function()   {\n    var elementId = prefix + 'Overlay_'   + that.vidId;\n    var htmlElement = document.getElementById(elementId);\n    //if (!htmlElement) { debug.warn ('getOverlay(): Error: htmlElement is empty:', htmlElement); }\n    return htmlElement;\n  };\n\n  that.getVideo = function() {\n    var elementId = prefix + 'Element_'   + that.vidId;\n    //console.log('!!!!!!!!!!', elementId);\n    var htmlElement = document.getElementById(elementId);\n    // if (!htmlElement) { debug.warn ('getOverlay(): Error: htmlElement is empty:', htmlElement); }\n    return htmlElement;\n  };\n\n  that.getConnId      = function() { return mediaIndex;    };\n\n\n  var DEFAULT_VIDEO_SIZE = VIDEO.SIZE_320x240;\n\n  that.getVideoWidth  = function() {\n    var result;\n    var htmlVideo = that.getVideo();\n    // Temasys/IE10 uses videoTrackHeight & videoTrackWidth\n    if (htmlVideo) {\n      result = htmlVideo.videoWidth  ? htmlVideo.videoWidth  : htmlVideo.videoTrackWidth;\n    } else {\n      result = DEFAULT_VIDEO_SIZE.width;\n    }\n    return result;\n  };\n\n  that.getVideoHeight = function() {\n    var result;\n    var htmlVideo = that.getVideo();\n\n    // Temasys/IE10 uses videoTrackHeight & videoTrackWidth\n    if (htmlVideo) {\n      result = htmlVideo.videoHeight ? htmlVideo.videoHeight : htmlVideo.videoTrackHeight;\n    } else {\n      result = DEFAULT_VIDEO_SIZE.height;\n    }\n    return result;\n  };\n\n  that.getVideoSize = function() {\n    return ( { width: that.getVideoWidth(), height: that.getVideoHeight } );\n  };\n\n  that.setVisible = function() {\n    //debug.log('Vid.setVisible(): that.isActive():', that.isActive(), '; that.showActive:', that.showActive, '; that.showInactive:',that.showInactive);\n\n    // Set video visibility\n    //that.getContainer().style.display =\n    //  (that.isActive() && that.showActive) || (!that.isActive() && that.showInactive) ?\n    //    'block' : 'none';\n\n    // Set poster (static picture) visibility\n    //var posterImageUrl;\n\n    //var class1 = that.isActive() ? 'wrtcActiveFalse' : 'wrtcActiveTrue';\n    if ( that.isActive() ) {        // If we have stream\n      elementSetClass( that.getContainer(), 'wrtcActiveFalse', 'wrtcActiveTrue');\n    } else {\n      elementSetClass( that.getContainer(), 'wrtcActiveTrue',  'wrtcActiveFalse');\n    }\n\n    if ( that.stream && that.stream.hasVideo() ) { // ...and there is Video tracks\n      elementSetClass( that.getContainer(), 'wrtcVideoFalse', 'wrtcVideoTrue');\n    } else {                        // ...if no Video Tracks\n      elementSetClass( that.getContainer(), 'wrtcVideoTrue', 'wrtcVideoFalse');\n    }\n\n  };\n\n  //that.setShowInactive = function (value) {\n  //  that.showInactive = value;\n  //  that.setVisible();\n  //};\n  //\n  //that.setShowActive = function (value) {\n  //  that.showActive = value;\n  //  that.setVisible();\n  //};\n  //\n  //that.setPoster = function (value) {\n  //  that.poster = value;\n  //  that.setVisible();\n  //};\n\n  that.isActive = function() {\n    return !! that.stream;\n  };\n\n  that.createHtml(that.mediaType, that.mediaIndex, that.vidId, localOrRemote);\n\n\n  that.setMuted = function(value) {\n    var htmlVideo = that.getVideo();\n    if (htmlVideo) {\n      htmlVideo.muted = value;\n    }\n  };\n\n  that.toggleMuted = function() {\n    var htmlVideo = that.getVideo();\n    if (htmlVideo) {\n      htmlVideo.muted = ! htmlVideo.muted;\n    }\n    elementFlipOnOff(that.getContainer().getElementsByClassName('wrtcSpeakerBtn'));\n    debug.log('need to set element class according to real element state');\n\n  };\n\n  that.toggleFullScreen = function() {\n    var htmlVideo = that.getVideo(); // getVideoByButton(sender);\n    var isFullScreen = false;\n\n    if (htmlVideo) {\n      var fullScreenToggled = fullScreen.toggle(htmlVideo);\n\n      if ( ! fullScreenToggled ) {\n        debug.warn('wrtcFullScreenBtn click: fullScreen.toggle(htmlVideo) not supported. fallback to maximize.');\n\n        if (that.maximized) {\n          that.parent.restoreChild();\n\n        } else {\n          that.parent.maximizeChild(that);\n          isFullScreen = true;\n        }\n      } else {\n        isFullScreen = fullScreen.getEnabled();\n      }\n    }\n    elementSetOnOff( that.getContainer().getElementsByClassName('wrtcFullScreenBtn'), isFullScreen);\n    //elementFlipOnOff( document.getElementsByClassName('wrtcFullScreenBtn') );\n  };\n\n  that.toggleVideoEnabled = function() {\n    if (that.stream) {\n      that.stream.toggleVideoEnabled();\n      elementSetOnOff( that.getContainer().getElementsByClassName('wrtcVideoBtn'), that.stream.videoEnabled );\n    }\n  };\n\n\n  // Attach events to buttons\n\n  var htmlContainer = that.getContainer();\n\n  addEvent(htmlContainer, 'dblclick', function(event) {\n    debug.log('htmlContainer dblclick');\n    that.toggleFullScreen();\n    event.preventDefault(); event.stopPropagation();\n  });\n\n  addEventByClass(htmlContainer, 'wrtcPanel', 'dblclick', function(event) {\n    debug.log('wrtcPanel dblclick');\n    // Ignore double clicks on panels with buttons\n    event.preventDefault(); event.stopPropagation();\n  });\n\n  addEventByClass(htmlContainer, 'wrtcSpeakerBtn', 'click', function(event) {\n    debug.log('wrtcSpeakerBtn click');\n    that.toggleMuted();\n    event.preventDefault(); event.stopPropagation();\n  });\n\n  addEventByClass(htmlContainer, 'wrtcVideoBtn', 'click', function(event) {\n    debug.log('wrtcVideoBtn click');\n    // At some time muting for screencast was disabled in Chrome source code\n    // More info: https://code.google.com/p/chromium/codesearch#chromium/src/third_party/libjingle/source/talk/media/webrtc/webrtcvideoengine.cc&q=Disable%20muting%20for%20screencast.&sq=package:chromium&type=cs&l=3232\n    that.toggleVideoEnabled();\n    event.preventDefault(); event.stopPropagation();\n  });\n\n  addEventByClass(htmlContainer, 'wrtcMicBtn', 'click', function(event) {\n    debug.log('wrtcMicBtn click');\n    if (that.stream) {\n      that.stream.toggleAudioEnabled();\n      elementFlipOnOff(event.target);\n    }\n    event.preventDefault(); event.stopPropagation();\n  });\n\n  addEventByClass(htmlContainer, 'wrtcInfoBtn', 'click', function(event) {\n    debug.log('wrtcInfoBtn click');\n    var htmlVideo = that.getVideo(); // getVideoByButton(sender);\n    if (htmlVideo) {\n      doShowStats(htmlVideo);\n    }\n    event.preventDefault(); event.stopPropagation();\n  });\n\n  addEventByClass(htmlContainer, 'wrtcFullScreenBtn', 'click', function(event) {\n    debug.log('wrtcFullScreenBtn click');\n    that.toggleFullScreen();\n    event.preventDefault(); event.stopPropagation();\n  });\n\n  addEventByClass(htmlContainer, 'wrtcHangupOneBtn', 'click', function (event) {\n    // find one of parents which contains data-conn-id attribute\n    var el = event.target;\n    var cls = 'wrtcContainer';\n    while ((el = el.parentElement) && !el.classList.contains(cls));\n    var connId = el.getAttribute('data-conn-id');\n\n    console.log('el:', el, '; connId:', connId);\n    //\n    // find connection\n    var conn = peerConnections.find(connId);\n    if (!conn) { console.error('wrtcHangupOneBtn: Connection not found: connId:', connId); }\n    peerConnections.hangupFromLocal(conn.remoteUser, conn.connId);\n  });\n\n\n\n  that.init();\n\n  return that;\n};\n\n/*\n // http://www.html5rocks.com/en/tutorials/getusermedia/intro/\n // Note: onloadedmetadata doesn't fire in Chrome when using it with getUserMedia.\n // See crbug.com/110938.\n self.video.onloadedmetadata = function(e) {\n console.log('localMedia.start(): success: self.video.onloadedmeadata()');\n };\n\n */\n/*\n // All of following does not works in IE10+Temasys\n //\n // https://hacks.mozilla.org/2013/02/cross-browser-camera-capture-with-getusermediawebrtc/\n video.addEventListener('loadstart', function() {\n console.log('video.addEventListener(\"loadstart\"): Video dimensions: ' + video.videoWidth + ' x ' + video.videoHeight);\n }, false);\n video.addEventListener('progress', function() {\n console.log('video.addEventListener(\"progress\"): Video dimensions: ' + video.videoWidth + ' x ' + video.videoHeight);\n }, false);\n // http://www.html5rocks.com/en/tutorials/getusermedia/intro/\n // Note: onloadedmetadata doesn't fire in Chrome when using it with getUserMedia.\n // See crbug.com/110938.\n video.addEventListener('loadedmetadata', function() {\n console.log('video.addEventListener(\"onloadedmetadata\"): Video dimensions: ' + video.videoWidth + ' x ' + video.videoHeight);\n }, false);\n video.addEventListener('loadeddata', function() {\n console.log('video.addEventListener(\"loadeddata\"): Video dimensions: ' + video.videoWidth + ' x ' + video.videoHeight);\n }, false);\n video.addEventListener('canplay', function() {\n console.log('video.addEventListener(\"canplay\"): Video dimensions: ' + video.videoWidth + ' x ' + video.videoHeight);\n }, false);\n video.addEventListener('canplaythrough', function() {\n console.log('video.addEventListener(\"canplaythrough\"): Video dimensions: ' + video.videoWidth + ' x ' + video.videoHeight);\n }, false);\n video.addEventListener('play', function() {\n console.log('video.addEventListener(\"play\"): Video dimensions: ' + video.videoWidth + ' x ' + video.videoHeight);\n }, false);\n video.addEventListener('playing', function() {\n console.log('video.addEventListener(\"playing\"): Video dimensions: ' + video.videoWidth + ' x ' + video.videoHeight);\n }, false);\n\n video.playing = function() {\n console.log('video.onplaying: Video dimensions: ' + video.videoWidth + ' x ' + video.videoHeight);\n }\n\n progress\n\n */\n\nif (typeof module !== 'undefined') {\n  module.exports.Vid = Vid;\n  module.exports.LOCAL_OR_REMOTE = LOCAL_OR_REMOTE;\n  module.exports.MEDIA_TYPE = MEDIA_TYPE;\n  module.exports.ALIGN = ALIGN;\n}\n\nif (typeof window !== 'undefined') {\n  window.Vid  = Vid;\n  window.LOCAL_OR_REMOTE  = LOCAL_OR_REMOTE;\n  window.MEDIA_TYPE  = MEDIA_TYPE;\n  window.ALIGN  = ALIGN;\n}\n",
    "/**\n * Created by alykoshin on 3/21/14.\n */\n\n'use strict';\n\nif ( typeof module !== 'undefined' && typeof require !== 'undefined') {\n  var debug   = require('./../../mylib/utils.js').debug;\n  var BasicContainer = require('./basicContainer.js');\n}\n\n\nvar\n  FROM_BOTTOM    = 0,//280, // - to leave place for a local previews\n\n  MIN_WIDTH      =  80, // 320,\n  MIN_HEIGHT     =  80, //240,\n\n  PREVIEW_WIDTH  = 320,\n  PREVIEW_HEIGHT = 240,\n\n  MARGIN         =  10;\n\nvar POSITIONING_DIR = Enum({\n  LEFT_TO_RIGHT: 'LEFT_TO_RIGHT',\n  RIGHT_TO_LEFT: 'RIGHT_TO_LEFT'\n});\n\n\n\nvar VideoHolder = function(holderElementId) {\n  var that    = new BasicContainer(/*parentId, holderElementId*/);\n\n  that.muted = false;\n  debug.log('need to set all the video to muted var');\n\n  that.audioEnabled = true;\n  that.videoEnabled = true;\n\n\n  that.holder = document.getElementById(holderElementId);\n\n  that.parentElement = that.holder.parentNode;\n\n  /**\n   * Pointer to maximized Child Element\n   * @type {null}\n   */\n  that.maximizedChild = null;\n\n  // !!! for compatibility with BasicContainer\n  that.getContainer = function() { return that.holder; };\n  // !!!\n\n  that.vids   = []; // Array which holds all existing vids\n\n  that.localOrRemote  = null; // Local or Remote Videos\n  that.positioningDir = POSITIONING_DIR.LEFT_TO_RIGHT; // By default position Vids from left to right\n\n  that._add = function(vid) {\n    /** Set handler to process stream size changes\n     * (especially significant when stream starts to properly position it)\n     */\n    vid.onStreamResize = function(width, height) {\n      //      var video = vid.getVideo();\n      //      if (video) {\n      //        video.parentNode.style.display = 'block'; /** Make container visible **/\n      //      }\n      that.repositionAll();  // Adjust all positions of the videos\n    };\n    that.vids.push(vid);\n\n    delayedRepositionAll(); // Reposition all elements\n    return vid;\n  };\n\n  that.add = function(mediaType, mediaIndex) {\n    debug.groupCollapsed('VideoHolder.add()');\n    //              parent,          localOrRemote,      mediaType, mediaIndex\n    var v = new Vid(that/*.holder*/, that.localOrRemote, mediaType,  mediaIndex);\n    v.setMuted( that.muted );\n    that._add(v);\n\n    // Not possible to reposition Videos here as video stream is not yet received\n    // and its size is not known yet\n    debug.groupEnd();\n    return v;\n  };\n\n  that._del = function(vid) {\n    if (vid) {\n      vid.cleanup();\n      for (var i = that.vids.length - 1; i >= 0; i--) {\n        if (that.vids[i] === vid) {\n          that.vids.splice(i, 1);\n        }\n      }\n      delayedRepositionAll(); // Reposition all elements\n    }\n  };\n\n  that.count =  function() {\n    return that.vids.length;\n  };\n\n  that._getVids = function() {\n    return that.vids;\n  };\n\n  that.availableWidth = function() {\n    return that.holder.clientWidth; //window.innerWidth,\n  };\n\n  that.availableHeight = function() {\n    return that.holder.clientHeight;       //window.innerHeight;\n  };\n\n  that.adjustHolderSize = function() {\n    throw 'VideoHolder.adjustHolderSize(): Call to abstract function.';\n  };\n\n  that.repositionAll = function() {\n    throw 'VideoHolder.repositionAll(): Call to abstract function.';\n  };\n\n\n\n  that.getMaximizeSize = that.getDocumentSize; // For normal container it is getParentSize. For Container Holder it is getDocumentSize\n\n  that.maximizeChild = function( container ) {\n    //debug.log('VideoHolder.maximizeChild(): that.getMaximizeSize: 1', that.getMaximizeSize);\n    that.maximize();\n    //debug.log('VideoHolder.maximizeChild(): that.getMaximizeSize: 2', container);\n    container.maximize();\n    that.maximizedChild = container;\n  };\n\n  that.restoreChild = function() {\n    //debug.log('VideoHolder.restoreChild()')\n    that.restore();\n    that.reset();\n    // Restore child size\n    if (that.maximizedChild) {\n      that.maximizedChild.restore();\n      that.maximizedChild = null;\n    }\n    delayedRepositionAll();\n  };\n\n\n\n  /**\n   * @param {string} align\n   * @param {{left: number, top: number, width: number, height: number}} area\n   * @param {number} vidScreenIdx\n   * @param {object[]} vids\n   * @param {number} vidArrayIdx\n   */\n  that.repositionInLineOne = function(align, area, vidScreenIdx, vids, vidArrayIdx) {\n    //console.log('repositionInLineOne: align:', align, '; area:', area, '; vidScreenIdx:', vidScreenIdx, '; vidArrayIdx:', vidArrayIdx);\n    ALIGN.check(align);\n\n    //debug.log('VideoHolder.repositionInLineOne()');\n    var availW = ( area.width  -   MARGIN ) / vids.length - MARGIN;\n    var availH =   area.height - 2*MARGIN;  // - FROM_BOTTOM; /** This was needed before Holder's auto resize **/\n\n    // Limit minimum size\n    if (availW < MIN_WIDTH)  { availW = MIN_WIDTH;  }\n    if (availH < MIN_HEIGHT) { availH = MIN_HEIGHT; }\n\n    var leftX = (availW + MARGIN ) * vidScreenIdx  + MARGIN;\n    var topY  =  area.top + MARGIN;\n\n    vids[ vidArrayIdx ].positionVideoInRect(align, leftX, topY, leftX+availW, topY+availH);\n  };\n\n  /**\n   *\n   * @param {string} align\n   * @param {{left: number, top: number, width: number, height: number}} area\n   * @param {object[]} vids\n   */\n  that.repositionInLineArray = function(align, area, vids) {\n    ALIGN.check(align);\n\n    // Reverse the order if needed\n    if (that.positioningDir === POSITIONING_DIR.RIGHT_TO_LEFT) {\n      vids.reverse();\n    }\n\n    for (var i = 0; i < vids.length; i++) {\n      that.repositionInLineOne(align, area, i, vids, i);\n    }\n\n  };\n\n  that.repositionInLine = function() {\n    //debug.debug('repositionInLine()');\n\n    POSITIONING_DIR.check(that.positioningDir);\n\n    // Define area to place vids\n    var area = {\n      left: 0,\n      top:0,\n      width:  that.availableWidth(),\n      height: that.availableHeight()\n    };\n\n    // Take a copy of vids array\n    var vids = that.vids.slice();\n\n    that.repositionInLineArray(ALIGN.CENTER, area, vids);\n  };\n\n  /**\n   * Reposition to one big video and set af smaller below\n   */\n  that.repositionOneLeftOtherBelow = function() {\n    //debug.debug('repositionInLine()');\n\n    POSITIONING_DIR.check(that.positioningDir);\n\n    var heightRatioBig = 1,   // 0.7, // 80% of height - first image, 20% for others\n      heightRatioSmall = 0.3; // 1-heightRatioBig\n\n    var area1 = {\n      left:   0,\n      top:    0,\n      width:  that.availableWidth(),\n      height: that.availableHeight() * heightRatioBig\n    };\n    var area2 = {\n      left:   0,\n      top:    that.availableHeight() * (1-heightRatioSmall),\n      width:  that.availableWidth(),\n      height: that.availableHeight()  * heightRatioSmall\n    };\n\n    // Take a copy of vids array\n    var vids = that.vids.slice();\n\n    if (vids.length > 0) {\n      var vids1 = vids.slice(0,1);\n      var vids2 = vids.slice(1);\n\n      that.repositionInLineArray(ALIGN.LEFT, area1, vids1);\n      that.repositionInLineArray(ALIGN.CENTER, area2, vids2);\n    }\n\n  };\n\n  that.toggleMuted = function() {\n    that.muted = ! that.muted;\n    for (var i = 0; i < that.count(); i++) {\n      that.vids[i].setMuted(that.muted);\n    }\n  };\n\n  that.toggleAudioEnabled = function() {\n    that.audioEnabled = ! that.audioEnabled;\n    for (var i = 0; i < that.count(); i++) {\n      var stream = that.vids[i].stream;\n      if (stream) {\n        stream.setAudioEnabled(that.audioEnabled);\n      }\n    }\n  };\n\n  that.toggleVideoEnabled = function() {\n    that.videoEnabled = ! that.videoEnabled;\n    for (var i = 0; i < that.count(); i++) {\n      var stream = that.vids[i].stream;\n      if (stream) {\n        stream.setVideoEnabled(that.videoEnabled);\n      }\n    }\n  };\n\n  return that;\n};\n\nvar VideoHolder2 = function(holderElementId) {\n  var that = new VideoHolder(holderElementId);\n\n  // Dynamically add video containers\n  //    // Not possible to reposition Videos here as video stream is not yet received\n  //    // and its size is not known yet\n\n  that.delByConnId = function(connId) {\n    debug.log('VideoHolder.delByConnId(): connId:', connId);\n    var vid = that.findByConnId(connId);\n    that._del(vid);\n  };\n\n  that.findByConnId = function(connId) {\n    for (var i = that.vids.length-1; i >= 0; i--) {\n      if (that.vids[i].getConnId() === connId)  {\n        return that.vids[i];\n      }\n    }\n    return null;\n  };\n\n  return that;\n};\n\n/**\n *\n * @type {Function}\n */\n\nvar _LocalVideoHolder = function() {\n  var that = new VideoHolder2('wrtcLocalVideoHolder');\n\n  // Local Vids must be muted\n  that.muted = true;\n\n  that.localOrRemote  = LOCAL_OR_REMOTE.LOCAL;\n  that.positioningDir = POSITIONING_DIR.RIGHT_TO_LEFT; /** For LocalVideoHolder position Vids from right to left **/\n\n  that.repositionAll = that.repositionInLine;\n\n  that.adjustHolderSize = function() {\n    //    var docSize = that.getDocumentSize();\n    //\n    //    that.setSize(docSize.width / 2, 280 /*docSize.height / 2*/ );\n    //    that.setRightBottom(0,0);\n  };\n\n  return that;\n};\n\n/**\n *\n */\n\nvar _remoteVideoHolder = function() {\n  var that = new VideoHolder2('wrtcRemoteVideoHolder');\n\n  that.localOrRemote = LOCAL_OR_REMOTE.REMOTE;\n\n  /*  var super_add = that.add;\n   that.add = function(mediaType, infoText, connId) {\n   // call inherited function\n   var vid = super_add(mediaType, infoText, connId);\n   return vid;\n   };*/\n  that.adjustHolderSize = function() {\n    //    var docSize = that.getDocumentSize();\n    //\n    //    that.setSize(docSize.width, docSize.height - FROM_BOTTOM);\n    //    that.setRightTop(0,0);\n  };\n\n  that.reposition2 = function () {\n    debug.debug('reposition2()');\n\n    var fullW  = that.availableWidth();\n    var fullH  = that.availableHeight();\n    // Limit minimum size;\n    if (fullW < MIN_WIDTH) { fullW = MIN_WIDTH; }\n    var fullH1 = (fullH < MIN_HEIGHT             ) ? MIN_HEIGHT               : fullH;\n    var fullH2 = (fullH < MIN_HEIGHT+FROM_BOTTOM ) ? MIN_HEIGHT + FROM_BOTTOM : fullH;\n    //if (fullH < MIN_HEIGHT) fullH = MIN_HEIGHT;\n\n    that.vids[0].positionVideoInRect(\n      ALIGN.CENTER,\n      fullW  - PREVIEW_WIDTH*2 - MARGIN*2, fullH1 - PREVIEW_HEIGHT  - MARGIN,\n      fullW  - PREVIEW_WIDTH   - MARGIN*2, fullH1 -                   MARGIN,\n      1);\n    // 4 - as remote and local to be placed near each other\n    // however they are in different placeholders\n    that.vids[1].positionVideoInRect(\n      ALIGN.CENTER,\n      0     + MARGIN,                      0,\n      fullW - MARGIN,                      fullH2 - MIN_HEIGHT,\n      null);\n  };\n\n  that.repositionAll = that.repositionInLine; //function() {\n    //debug.debug('repositionAll()');\n\n    //var count = that.vids.length;\n    //if (count > 0) {\n      //      if (count === 2) {\n      //        that.reposition2();\n      //      } else {\n      //that.repositionInLine();\n      //      }\n    //}\n  //};\n\n  return that;\n};\n\n\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n// Repositioning on window size change\n\nvar RESIZE_DELAY1  = 0; // Delay in ms between Window resize and repositioning of Videos\nvar resizeTimeout1 = null;\n\nvar RESIZE_DELAY2  = 100; // Delay in ms between Window resize and repositioning of Videos\nvar resizeTimeout2 = null;\n\nfunction delayedRepositionAll() {\n\n  if (remoteVideos.maximizedChild) {\n    remoteVideos.maximizeChild( remoteVideos.maximizedChild );\n    return; // Do not reposition if something is maximized\n\n  } else if (LocalVideoHolder.maximizedChild) {\n    LocalVideoHolder.maximizeChild( LocalVideoHolder.maximizedChild );\n    return; // Do not reposition if something is maximized\n  }\n\n  if (resizeTimeout1) {\n    clearTimeout( resizeTimeout1 );\n  }\n  if (resizeTimeout2) {\n    clearTimeout( resizeTimeout2 );\n  }\n  resizeTimeout1 = setTimeout(function () {\n    //debug.log('delayedRepositionAll(): setTimeout1()');\n    remoteVideos.adjustHolderSize(); // Need to be called before repositionAll\n    LocalVideoHolder.adjustHolderSize();\n\n    resizeTimeout2 = setTimeout(function () {\n      //debug.log('delayedRepositionAll(): setTimeout2()');\n      remoteVideos.repositionAll();\n      LocalVideoHolder.repositionAll();\n    }, RESIZE_DELAY2);\n\n  }, RESIZE_DELAY1);\n}\n\n/**\n */\naddEvent(window, 'resize', delayedRepositionAll);\n\n//\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nif (typeof module !== 'undefined') {\n  module.exports._LocalVideoHolder  = _LocalVideoHolder;\n  module.exports._remoteVideoHolder = _remoteVideoHolder;\n}\n\nif (typeof window !== 'undefined') {\n  window._LocalVideoHolder  = _LocalVideoHolder;\n  window._remoteVideoHolder = _remoteVideoHolder;\n}\n",
    "/**\n * Created by alykoshin on 9/23/14.\n */\n\n'use strict';\n\nif ( typeof module !== 'undefined' && typeof require !== 'undefined') {\n  var debug   = require('./../../mylib/utils.js').debug;\n}\n\n// todo: need to check exact chrome browser because opera/node-webkit also uses chromium framework\nvar isChrome = !!navigator.webkitGetUserMedia;\n\n// DetectRTC.js - github.com/muaz-khan/WebRTC-Experiment/tree/master/DetectRTC\n// Below code is taken from RTCMultiConnection-v1.8.js (http://www.rtcmulticonnection.org/changes-log/#v1.8)\nvar DetectRTC = {};\n\n(function () {\n  var screenCallback;\n\n  var MSG_GET_SOURCE_ID = 'get-sourceId';\n  var MSG_ARE_YOU_THERE = 'are-you-there';\n  var MSG_EXT_LOADED    = 'rtcmulticonnection-extension-loaded';\n\n  DetectRTC.screen = {\n\n    chromeMediaSource: 'screen',\n\n    getSourceId: function (callback) {\n      if (!callback) { throw 'DetectRTC.screen.getSourceId(): \"callback\" parameter is mandatory.'; }\n      screenCallback = callback;\n      window.postMessage(MSG_GET_SOURCE_ID, '*');\n      console.log('DetectRTC.screen.isChromeExtensionAvailable(): window.postMessage(\\' '+MSG_GET_SOURCE_ID+' \\', \\'*\\')');\n    },\n\n    isChromeExtensionAvailable: function (callback) {\n      // if (!callback) { return; }\n\n      if (DetectRTC.screen.chromeMediaSource === 'desktop') {\n        console.log('DetectRTC.screen.isChromeExtensionAvailable(): DetectRTC.screen.chromeMediaSource === \\'desktop\\', callback(true);');\n        if (callback) { callback(true); }\n      }\n\n      // ask extension if it is available\n      window.postMessage(MSG_ARE_YOU_THERE, '*');\n      console.log('DetectRTC.screen.isChromeExtensionAvailable(): window.postMessage(\\''+MSG_ARE_YOU_THERE+'\\', \\'*\\')');\n\n      setTimeout(function () {\n        if (DetectRTC.screen.chromeMediaSource === 'screen') {\n          console.log('DetectRTC.screen.isChromeExtensionAvailable(): DetectRTC.screen.chromeMediaSource === \\'screen\\', callback(false);');\n          if (callback) { callback(false); }\n        } else {\n          console.log('DetectRTC.screen.isChromeExtensionAvailable(): DetectRTC.screen.chromeMediaSource !== \\'screen\\', callback(true);');\n          if (callback) { callback(true); }\n        }\n      }, 2000);\n    },\n\n    onMessageCallback: function (data) {\n      console.log('DetectRTC.screen.onMessageCallback(): data:', data);\n\n      // \"cancel\" button is clicked\n      if (data == 'PermissionDeniedError') {\n        DetectRTC.screen.chromeMediaSource = 'DetectRTC.screen.onMessageCallback(): PermissionDeniedError';\n        if (screenCallback) { return screenCallback('DetectRTC.screen.onMessageCallback(): PermissionDeniedError'); }\n        else { throw new Error('DetectRTC.screen.onMessageCallback(): PermissionDeniedError'); }\n      }\n\n      // extension notified his presence\n      if (data == MSG_EXT_LOADED) {\n        DetectRTC.screen.chromeMediaSource = 'desktop';\n      }\n\n      // extension shared temp sourceId\n      if (data.sourceId) {\n        DetectRTC.screen.sourceId = data.sourceId;\n        if (screenCallback) { screenCallback(DetectRTC.screen.sourceId); }\n      }\n    }\n\n  };\n\n\n  DetectRTC.init = function() {\n\n    window.addEventListener('message', function (event) {\n      if (event.origin != window.location.origin) {\n        return;\n      }\n      DetectRTC.screen.onMessageCallback(event.data);\n    });\n\n    // check if desktop-capture extension installed.\n    if (window.postMessage && isChrome) {\n      DetectRTC.screen.isChromeExtensionAvailable();\n    }\n\n    console.log('DetectRTC.screen.init(): DetectRTC.screen.chromeMediaSource', DetectRTC.screen.chromeMediaSource);\n  }\n\n\n})();\n\n\nif (typeof module !== 'undefined') {\n  module.exports.DetectRTC  = DetectRTC;\n}\n\nif (typeof window !== 'undefined') {\n  window.DetectRTC  = DetectRTC;\n}\n",
    "/**\n * Created by alykoshin on 3/21/14.\n */\n\n'use strict';\n\nif ( typeof module !== 'undefined' && typeof require !== 'undefined') {\n  var debug     = require('./../../mylib/utils.js').debug;\n  var UserMedia = require('./userMediaController.js');\n  //var mediaConstraints = require('./mediaConstraints.js').MediaConstraints;\n  var VIDEO = require('./mediaConstraints.js').VIDEO;\n}\n\n//var\n//  SHOW_INACTIVE_VIDEO  = false,//false,\n//  SHOW_ACTIVE_VIDEO    = true,\n//  SHOW_INACTIVE_SCREEN = false, //false,\n//  SHOW_ACTIVE_SCREEN   = true;\n//\n//var POSTER_VIDEO    = '/images/wrtc_poster_video.png';\n//var POSTER_SCREEN   = '/images/wrtc_poster_screen.png';\n//var POSTER_NO_VIDEO = '/images/wrtc_poster_user.png';\n\nvar DEFAULT_PREVIEW_SIZE = VIDEO.SIZE_320x240;\n\n\n// Local stream object\n\n//var localMediaBase = function() {\n//  var that = {};\n//  return that;\n//};\n/**\n *\n * @param {number} localMediaIndex\n * @returns {UserMedia}\n * @constructor\n */\nvar LocalMedia = function(localMediaIndex) {\n\n  var MSG_NO_ACCESS = 'No access to audio/video',\n    MSG_CANT_ACCESS = 'Cannot get access to media stream from local device',\n    MSG_CANT_CAM_MIC = MSG_CANT_ACCESS + ' (camera/microphone).', /* + ' \\n\\n' +\n   'Please make sure to enable chrome flag chrome://flags/#enable-usermedia-screen-capture ', */\n    MSG_CANT_CAM_MIC_SCR = MSG_CANT_ACCESS + ' (camera/microphonee/screen capture).';\n\n  var MSG_ERROR_TYPE_OLD = 'Old or incompatible browser',\n    MSG_ERROR_NOT_SUPPORTED = 'Currently the browser you are using does not support webRTC.',\n    MSG_SUPPORTED_BROWSERS = 'Supported browsers are:' +\n      '\\n'+'- <a href=\"https://chrome.google.com\">Chrome</a>/Chromium (recommended)' +\n      '\\n'+'- <a href=\"http://getfirefox.com\">Firefox</a> (with some limitations)' +\n      (CONFIG.TEMASYS ? '\\n'+'- IE10/11 with <a href=' + CONFIG.TEMASYS.DOWNLOAD.HOME + '>special plugin</a>' : '')+\n      '';\n\n  var MSG_ERROR_TYPE_INIT = 'Error initializing video conference',\n    MSG_IE10 = 'Unfortunately we only support Internet Explorer-10 for video/audio conference. ' +\n      'We are working on making it compatible with other latest versions also. ',\n    MSG_ERROR_NEED_PLUGIN= 'Your browser does not support video conference. Please download plugin.';\n\n  var MSG_DOWNLOAD = 'Download plugin...',\n    MSG_DOWNLOAD_START = 'Plugin download will start automatically in several seconds...\\n',\n    MSG_DOWNLOAD_FROM_TROUBLES = 'If you experience troubles with automatic download, you can download plugin from\\n',\n    MSG_DOWNLOAD_FROM_HOME = CONFIG.TEMASYS ? '<a href='+CONFIG.TEMASYS.DOWNLOAD.HOME+'>Download page</a>\\n' : '',\n    MSG_DOWNLOAD_FROM = (CONFIG.TEMASYS && CONFIG.TEMASYS.DOWNLOAD.HOME) ? MSG_DOWNLOAD_FROM_TROUBLES + MSG_DOWNLOAD_FROM_HOME : '', // If downloads homepage is set in config\n    MSG_UNINSTALL = 'Please, make sure you uninstalled any previous version of plugin before installing this one!';\n\n  var self = new UserMedia();\n\n  //var x, y;\n\n  //  self.localMediaIndex = localMediaIndex;\n  self.vid             = null;\n  self.mediaType       = null;  /** Defined as MEDIA_TYPE.VIDEO, SCREEN **/\n  self.mediaIndex      = localMediaIndex;\n\n\n    //  /** Constraints for Audio+Video connection for Low and High Bandwidths **/\n    //  self.AV_LOW = {\n    //    audio: true,\n    //    video: {\n    //      mandatory: {\n    ////          maxFrameRate: 1,\n    //        maxWidth:  320,\n    //        maxHeight: 240 /** 180-- Gives wide picture, by removing bottom and top **/\n    //      },\n    //      optional: [/*{maxWidth:320,maxHeight:180}, {maxWidth:320,maxHeight:240}*/]\n    //    }\n    //  };\n\n    //  self.AV_HIGH = self.AV_HIGH || {\n    //    audio: true,\n    //    video: true\n    //  };\n\n  self.constraints   = self.constraints   || null;// { audio: true, video: true };\n\n  /** Events **/\n\n  self.onBeforeStart = self.onBeforeStart || null;\n  self.onAfterStart  = self.onAfterStart  || null;\n  self.onErrorStart  = self.onErrorStart  || null;\n\n  self.onBeforeStop  = self.onBeforeStop  || null;\n  self.onAfterStop   = self.onAfterStop   || null;\n\n  //  self.showActive    = self.showActive    || true;\n  //  self.showInactive  = self.showInactive  || false;\n\n  //var super_onGetUserMediaSuccess = self.onGetUserMediaSuccess;\n  /**\n   * onGetUserMediaSuccess\n   * @param newStream\n   **/\n  //self.onGetUserMediaSuccess = function (newStream) {\n  self.on('start', function(newStream) {\n    //    debug.groupCollapsed('LocalMedia.start(): onGetUserMediaSuccess()');\n    debug.debug('LocalMedia.start(): onGetUserMediaSuccess(): ' +\n      ': self.mediaType: ', self.mediaType ,\n      '; newStream:',       newStream);\n\n    //super_onGetUserMediaSuccess(newStream);\n\n    self.vid.attach(self.stream);\n    self.vid.setVisible();\n\n\n    if (self.callback)     { self.callback();     }\n    if (self.onAfterStart) { self.onAfterStart(); }\n\n    //    debug.groupEnd();\n  });\n  //  self.onStart = function(stream) {\n  //    self.vid.attach(self.stream);\n  //    self.vid.setVisible();\n  //  };\n\n\n  //var super_onGetUserMediaError2 = self.onGetUserMediaError2;\n  /**\n   * onGetUserMediaError2\n   * @param error\n   */\n  //self.onGetUserMediaError2 = function (error) {\n  //self.onError = function (error) {\n  //  super_onGetUserMediaError2(error);\n  self.on('error', function() {\n    if (get_browser() === 'Chrome') {\n      // 4.If user is on Chrome , and user don't have camera or does not give acccess to camera then show alert\n      // \"Cannot get access to media stream from local device (camera/microphone).\n      // Please make sure to enable chrome flag chrome://flags/#enable-usermedia-screen-capture \"\n      messageWrtc(MSG_NO_ACCESS, MSG_CANT_CAM_MIC, '', '' /* error */ /* Hide technical info */ );\n    } else {\n      messageWrtc(MSG_NO_ACCESS, MSG_CANT_CAM_MIC_SCR, '', '' /* error*/ /*Hide technical info*/);\n    }\n  });\n\n  // Start local stream and call callback\n  var super_start = self.start;\n  self.start = function( callback ) {\n    debug.log('LocalMedia.start(): self.mediaType:'+self.mediaType);\n\n    if ( ! isWebRTCCompatible() ) {\n\n      if (CONFIG.TEMASYS && (get_browser() === 'MSIE' || get_browser() === 'Safari') ) { // Need to check if we may work with plugin\n\n        if (get_browser() === 'MSIE' && get_browser_version() !== '10' && get_browser_version() !== '11') {\n          //        2.If browser is IE , and there is any error due to browser version. then show alert\n          //        \"Unfortunately we only support Internet Explorer-10 for video/audio conference.\n          //        We are working on making it compatible with other latest versions also. \"\n          messageBox(MSG_ERROR_TYPE_INIT, MSG_IE10);\n\n        } else {\n          //       1.If browser is IE , and there is any error due to temasys plugin , then show alert\n          //       Your browser does not support video conference. Please download plugin.\n          //       And then when user click on OK button then automatically start download of plugin from our own server.\n          var link;\n          // Links from here: https://temasys.atlassian.net/wiki/display/TWPP/WebRTC+Plugins          s\n          if (get_browser() == 'MSIE') { // Windows\n            link = CONFIG.TEMASYS.DOWNLOAD.IE;\n          } else {\n            link = CONFIG.TEMASYS.DOWNLOAD.SAFARI;\n          } // Mac OS X\n          var mb = messageBox(MSG_ERROR_TYPE_INIT, MSG_ERROR_NEED_PLUGIN);\n\n          mb.onClose = function () {\n            mb.onClose = null;\n            window.location.href = link;\n            messageBox(MSG_DOWNLOAD, MSG_DOWNLOAD_START + MSG_DOWNLOAD_FROM + MSG_UNINSTALL);\n          };\n        }\n      } else {\n        messageBox(MSG_ERROR_TYPE_OLD, MSG_ERROR_NOT_SUPPORTED, MSG_SUPPORTED_BROWSERS);\n      }\n\n    } else {\n      self.callback = callback;\n      if (self.isActive) { // If Local Media already started\n        if (self.callback) { self.callback(); }\n      } else {\n        super_start();\n      }\n    }\n    debug.groupEnd();\n  };\n\n  // Stop local stream\n  var super_stop = self.stop;\n  self.stop = function() {\n    super_stop();\n    detachMediaStream( self.vid.getVideo() );\n\n    if (self.onAfterStop) { self.onAfterStop.call(); }\n    self.vid.setVisible();\n  };\n\n\n  self.setLowBandwidth = function() {\n    self.constraints.setMinMaxSize(null, VIDEO.SIZE_QVGA);\n    self.constraints.setMinMaxFrameRate(null, 1);\n  };\n\n  var _dragstart = function(e) {\n    MEDIA_TYPE.check(self.mediaType);\n\n    if (self.mediaType !== MEDIA_TYPE.VIDEO) { return false; }\n    e.dataTransfer.setData('source', 'localVideo');\n\n    // Store id\n    //e.dataTransfer.setData(\"_id\", this._id);\n\n    // FF & Chrome support\n    var relX = e.offsetX ? e.offsetX : e.layerX;\n    var relY = e.offsetY ? e.offsetY : e.layerY;\n    //var absX = e.clientX;\n    //var absY = e.clientY;\n    e.dataTransfer.setData('relX', relX);\n    e.dataTransfer.setData('relY', relY);\n    e.dataTransfer.effectAllowed = 'move';\n    // e.dataTransfer.setData(\"Text\", e.target.getAttribute('id'));\n    e.dataTransfer.setDragImage(e.target, relX, relY);\n    return true;\n  };\n\n  var _dragover = function(ev) {\n    ev.preventDefault();\n  };\n\n  var _drop = function(ev) {\n    ev.preventDefault();\n    // FF & Chrome support\n    var x = ev.offsetX ? ev.offsetX : ev.layerX;\n    var y = ev.offsetY ? ev.offsetY : ev.layerY;\n\n    var origX = ev.dataTransfer.getData('relX');\n    var origY = ev.dataTransfer.getData('relY');\n\n    // if localVideo is under the pointer\n    //if (e.target.className.indexOf('cardimg') !== -1) {\n    if (ev.target.id === 'wrtcLocalVideoOverlay') {\n      // we need to take into account its position relative to parent\n      x += ev.target.parentElement.offsetLeft;\n      y += ev.target.parentElement.offsetTop;\n    }\n    if (ev.dataTransfer.getData('source') === ('localVideo')) {\n      var targetX = x - origX, targetY = y - origY;\n      targetX = (targetX > 0) ? targetX : 0;\n      targetY = (targetY > 0) ? targetY : 0;\n      debug.debug('drop: x:',x,'; y:', y, '; origX:', origX, '; origY:', origY, '; targetX:', targetX, '; targetY:', targetY);\n      //self.vid.toNearestCorner(targetX, targetY);\n      //localVideo.setXY( targetX,  targetY );\n      debug.log('LocalMedia.init(): drop(): Drag&drop disabled.');\n    }\n    ev.stopPropagation();\n    return false;\n  };\n\n  self.init = function() {\n\n    debug.log('LocalMedia.init(): - enter');\n    debug.log('LocalMedia.init(): self.mediaType:' + self.mediaType + '; self.mediaIndex:' + self.mediaIndex);\n\n    //var vidId = self.mediaType+'_'+self.mediaIndex;\n    self.vid = LocalVideoHolder.add(self.mediaType, self.mediaIndex); //vidId);\n    self.vid.setVisible();\n\n    /** Set constraints to appropriate audio/video source (if set) **/\n    debug.log('LocalMedia.init(): self.constraints.getValue():' + JSON.stringify(self.constraints.getValue() ) +\n      '; self.vid: ', self.vid);\n\n    self.vid.getContainer().ondragstart = _dragstart;\n    document.body.ondragover          = _dragover;\n    //    document.getElementById('wrtcLocalVideoContainer').ondragover = function(ev) {\n    //    document.getElementById('wrtcLocalVideoOverlay').ondragover = function(ev) {\n    //    document.getElementById('wrtcRemoteVideoHolder').ondragover = function(ev) {\n    document.body.ondrop              = _drop;\n    //    document.getElementById('wrtcLocalVideoOverlay').ondrop = drop;\n    //    document.getElementById('wrtcLocalVideoContainer').ondrop = drop;\n    //    document.getElementById('wrtcRemoteVideoHolder').ondrop = drop;\n\n    debug.log('LocalMedia.init(): - exit');\n  };\n\n  return self;\n};\n\n\n\nvar LocalVideo = function( localVideoIndex ) {\n  var that = new LocalMedia( localVideoIndex );\n\n  that.mediaType    = MEDIA_TYPE.VIDEO;\n  that.mediaIndex   = localVideoIndex;\n\n  /**\n   * Id of preferred audio source (if set)\n   *\n   * property\n   * @type {string|null}\n   */\n  that.audioSource = null;\n  /**\n   * Id of preferred video source (if set)\n   * property\n   * @type {string|null}\n   */\n  that.videoSource = null;\n\n  /** Set constraints for video depending on the bandwidth option (low/high) **/\n  var super_start = that.start;\n  that.start = function( callback ) {\n    //that.constraints = () ? that.AV_LOW : that.AV_HIGH;\n    if (option_bw === BANDWIDTH.LOW) {\n      that.setLowBandwidth();\n      //      that.constraints.setMinMaxSize(null, VIDEO.SIZE_QVGA);\n    }\n    // that.constraints.setMinMaxFrameRate(null, 24);\n    super_start( callback );\n  };\n\n  return that;\n};\n\n\n\nvar LocalScreen = ( function() {\n  var SCREEN_INDEX = 1; /** For Screen the number is always 0 **/\n  var that = new LocalMedia( SCREEN_INDEX );\n  that.mediaType = MEDIA_TYPE.SCREEN;\n\n\n  /** We do not set low bandwidth as for Screen Share it will result in unusable low quality video **/\n  that.constraints.setMinMaxSize(VIDEO.SIZE_2560x1440, VIDEO.SIZE_2560x1440);\n  //that.constraints.setMinMaxFrameRate(null, 1);\n  /* !!!                                                     */\n\n  return that;\n});\n\n\nif (typeof module !== 'undefined') {\n  module.exports.LocalVideo  = LocalVideo;\n  module.exports.LocalScreen  = LocalScreen;\n}\n\nif (typeof window !== 'undefined') {\n  window.LocalVideo   = LocalVideo;\n  window.LocalScreen  = LocalScreen;\n}\n",
    "/**\n * Created by alykoshin on 7/18/14.\n */\n\n'use strict';\n\nif ( typeof module !== 'undefined' && typeof require !== 'undefined') {\n\n}\n\n/**\n * @typedef {{width: number, height: number}} VIDEO_SIZE\n * @typedef {{min: number,   max:    number}} MIN_MAX\n */\n\n/**\n * Video sizes\n *\n * @enum\n * @const\n */\n\nvar VIDEO = {\n  /** @type VIDEO_SIZE **/\n  SIZE_320x180   : { width:  320, height:  180 }, /** 16:9 **/\n  SIZE_320x240   : { width:  320, height:  240 }, /**  4:3 **/\n  SIZE_640x480   : { width:  640, height:  480 }, /**  4:3 **/\n  SIZE_800x600   : { width:  800, height:  600 }, /**  4:3 **/\n  SIZE_1024x768  : { width: 1024, height:  768 }, /**  4:3 **/\n  SIZE_1280x720  : { width: 1280, height:  720 }, /** 16:9 **/\n  SIZE_1920x1080 : { width: 1920, height: 1080 }, /** 16:9 **/\n  SIZE_2560x1440 : { width: 2560, height: 1440 }  /** 16:9 **/\n};\n\n/**\n * Supplementary constants\n *\n * @type VIDEO_SIZE\n * @const\n */\nVIDEO.SIZE_QVGA     = VIDEO.SIZE_320x240;\nVIDEO.SIZE_VGA      = VIDEO.SIZE_640x480;\nVIDEO.SIZE_HD_720p  = VIDEO.SIZE_1280x720;\nVIDEO.SIZE_HD_1080p = VIDEO.SIZE_1920x1080;\nVIDEO.SIZE_HD_1440p = VIDEO.SIZE_2560x1440;\nVIDEO.SIZE_HD       = VIDEO.SIZE_HD_1440p;\n\n/**\n * <strong>Typical Aspect Ration values </strong> <p>\n * more on aspect ratios: <http://en.wikipedia.org/wiki/Aspect_ratio_%28image%29>\n *\n * @const\n **/\n\nvar ASPECT_RATIO = {\n  RATIO_4_3 : { min: 1.333, max: 1.334 }, /**  4:3 -- 320x240,  640x480,  800x600,   1024x768 **/\n  RATIO_16_9: { min: 1.777, max: 1.778 }  /** 16:9 --320x180, 1280x720, 1920x1080, 2560x1440 **/\n};\n\n/**\n * <strong> Typical Frame Rate values </strong> <p>\n * <em> more on frame rates: <a href=\"http://en.wikipedia.org/wiki/Frame_rate\">http://en.wikipedia.org/wiki/Frame_rate</a>\n *   <p>\n *   !!! Frame Rate is ignored in WebRTC in at least:\n *   Chromium Version 34.0.1847.116 Ubuntu 14.04 aura (260972)\n * </em>\n *\n * @namespace\n * @const\n * @enum\n */\nvar FRAME_RATE = {\n  RATE_10  :  10,\n  RATE_15  :  15,\n  RATE_30  :  30,\n\n  RATE_24  :  24,\n  RATE_25  :  25,\n  RATE_50  :  50,\n  RATE_60  :  60,\n  RATE_120 : 120\n};\n\n/** Media Constraints **/\n\n/**\n * @class\n * @constructor\n *\n * @returns {MediaConstraints}\n **/\nvar MediaConstraints = function () {\n\n  /**\n   * @type {MediaConstraints|{}}\n   */\n  var that = {};\n\n  /**\n   * Result value to be passed to getUserMedia() function\n   *\n   * private\n   *\n   * typedef {Object} SetOfConstraints\n   * property {number} [minFrameRate]\n   * property {number} [maxFrameRate]:,\n   * property {number} [minWidth]\n   * property {number} [maxWidth]\n   * property {number} [minHeight]\n   * property {number} [maxHeight]\n   * property {number} [minAspectRatio]\n   * property {number} [maxAspectRatio]\n   * property {string} [chromeMediaSource] // 'screen'\n   * property {string} [sourceId]\n   *\n   *\n   * typedef {Object} MandatoryAndOptional\n   *   property string mandatory\n   *\n   *   property SetOfConstraints[] optional1\n   * typedef {}\n   *\n   * type {{ video: string, audio: { mandatory: {string}, optional: {string} } }}\n   */\n  /**\n   *\n   * @type MediaStreamConstraints\n   */\n  var value = {};\n\n\n  /** Audio **/\n\n  /**\n   * Set audio enabled\n   *\n   * @memberOf MediaConstraints\n   * @param {boolean} flag\n   */\n  var setAudioEnabled = function (flag) {\n    value.audio = flag ? { mandatory: {}, optional: [] } : false;\n  };\n  that.setAudioEnabled = setAudioEnabled;\n\n\n  /**\n   * @memberOf MediaConstraints\n   */\n  var enableAudioIfDisabled = function() {\n    if (!value.audio) {      /** If Audio is disabled... **/\n      setAudioEnabled(true); /** ...then enable it       **/\n    }\n  };\n  that.enableAudioIfDisabled = enableAudioIfDisabled;\n\n\n  /**\n   * @memberOf MediaConstraints\n   * @param {string} sourceId\n   */\n  var setAudioSource = function(sourceId) {\n    if (sourceId) {\n      enableAudioIfDisabled();\n      value.audio.optional = [ { sourceId: sourceId } ];\n    } else {\n      setAudioEnabled( false );\n    }\n  };\n  that.setAudioSource = setAudioSource;\n\n\n  /** Video **/\n\n  /**\n   * @memberOf MediaConstraints\n   * @param {boolean} flag\n   */\n  var setVideoEnabled = function (flag) {\n    value.video = flag ? { mandatory: {}, optional: [] } : false;\n  };\n  that.setVideoEnabled = setVideoEnabled;\n\n\n  /**\n   * @memberOf MediaConstraints\n   */\n  var enableVideoIfDisabled = function() {\n    if (!value.video) {    /** If Video is disabled **/\n    setVideoEnabled(true); /** then enable it       **/\n    }\n  };\n  that.enableVideoIfDisabled = enableVideoIfDisabled;\n\n\n  /**\n   * @memberOf MediaConstraints\n   * @param {string} sourceId\n   */\n  var setVideoSource = function(sourceId) {\n    if (sourceId) {\n      enableVideoIfDisabled();\n      value.video.optional = [ { sourceId: sourceId } ];\n    } else {\n      setVideoEnabled( false );\n    }\n  };\n  that.setVideoSource = setVideoSource;\n\n\n  /**\n   * @memberOf MediaConstraints\n   * @param {{VIDEO_SIZE}} minValue\n   * @param {{VIDEO_SIZE}} maxValue\n   */\n  var setMinMaxSize = function (minValue, maxValue) {\n    enableVideoIfDisabled();\n    if (minValue) {\n      value.video.mandatory.minWidth  = minValue.width;\n      value.video.mandatory.minHeight = minValue.height;\n    }\n    if (maxValue) {\n      value.video.mandatory.maxWidth  = maxValue.width;\n      value.video.mandatory.maxHeight = maxValue.height;\n    }\n  };\n  that.setMinMaxSize = setMinMaxSize;\n\n\n  /**\n   * @memberOf MediaConstraints\n   * @param {number} minValue\n   * @param {number} maxValue\n   */\n  var setMinMaxAspectRatio = function (minValue, maxValue) {\n    enableVideoIfDisabled();\n    if (minValue) {\n      value.video.mandatory.minAspectRatio  = minValue;\n    }\n    if (maxValue) {\n      value.video.mandatory.maxAspectRatio  = maxValue;\n    }\n  };\n  that.setMinMaxAspectRatio = setMinMaxAspectRatio;\n\n\n  /**\n   * @memberOf MediaConstraints\n   * @param {number} minValue\n   * @param {number} maxValue\n   */\n  var setMinMaxFrameRate = function (minValue, maxValue) {\n    enableVideoIfDisabled();\n    if (minValue) {\n      value.video.mandatory.minFrameRate  = minValue;\n    }\n    if (maxValue) {\n      value.video.mandatory.maxFrameRate  = maxValue;\n    }\n  };\n  that.setMinMaxFrameRate = setMinMaxFrameRate;\n\n\n  /** Screen Share **/\n\n  /**\n   *\n   * New API !!!\n   * - https://groups.google.com/forum/#!msg/discuss-webrtc/TPQVKZnsF5g/fg2oBh1Er1wJ\n   * - https://developer.chrome.com/extensions/desktopCapture\n   * - https://developer.chrome.com/extensions/samples#desktop-capture-example\n   *\n   * Examples of working services:\n   * - https://meet.jit.si/\n   * - https://talky.io/\n   **/\n\n  /**\n   * @memberOf MediaConstraints\n   */\n  var setScreenEnabled = function() {\n    value.video.mandatory.chromeMediaSource = 'screen';\n    value.audio = false; /** Audio MUST be disabled for Screen Share **/\n  };\n  that.setScreenEnabled = setScreenEnabled;\n  /**\n   * @memberOf MediaConstraints\n   * @returns {boolean}\n   */\n  var getScreenEnabled = function() {\n    return !!(value.video && value.video.mandatory && value.video.mandatory.chromeMediaSource === 'screen');\n  };\n  that.getScreenEnabled = getScreenEnabled;\n\n  /**\n   * @memberOf MediaConstraints\n   * @param chromeMediaSourceId\n   */\n  var setDesktopEnabled = function(chromeMediaSourceId) {\n    value.video.mandatory.chromeMediaSource = 'desktop';\n    value.video.mandatory.chromeMediaSourceId = chromeMediaSourceId;\n    value.audio = false; /** Audio MUST be disabled for Screen Share **/\n  };\n  that.setDesktopEnabled = setDesktopEnabled;\n  /**\n   * @memberOf MediaConstraints\n   * @returns {boolean}\n   */\n  var getDesktopEnabled = function() {\n    return !!(value.video && value.video.mandatory && value.video.mandatory.chromeMediaSource === 'desktop');\n  };\n  that.getDesktopEnabled = getDesktopEnabled;\n\n  /** Get value to pass to getUserMedia function **/\n\n  /**\n   * @memberOf MediaConstraints\n   * @returns {MediaConstraints|{}}\n   */\n  that.getValue = function() {\n    return value;\n  };\n\n\n  /**\n   * Enable audio/video and set default values\n   *\n   * @private\n   */\n  var init = function() {\n    setAudioEnabled(true);\n    setVideoEnabled(true);\n  };\n\n  init();\n\n  return that;\n};\n\n\nif (typeof module !== 'undefined') {\n  module.exports.MediaConstraints  = MediaConstraints;\n  module.exports.VIDEO  = VIDEO;\n}\n\nif (typeof window !== 'undefined') {\n  window.MediaConstraints  = MediaConstraints;\n  window.VIDEO  = VIDEO;\n}\n",
    "/**\n * Created by alykoshin on 7/17/14.\n */\n\n'use strict';\n\nif ( typeof module !== 'undefined' && typeof require !== 'undefined') {\n  var debug     = require('./../../mylib/utils.js').debug;\n  var Emitter   = require('./../../mylib/emitter.js');\n  var DetectRTC = require('./detectRTC.js');\n}\n\n/**\n * @constrictor\n * @returns {__UserMedia}\n * @private\n */\nvar __UserMedia = function() {\n  var self = this;\n\n  Emitter(self);\n\n  /**\n   * @type {Object}\n   * @private\n   */\n  self._constraints = null;\n\n  /** low-level callbacks */\n  self._onGetUserMediaSuccess = null;\n  self._onGetUserMediaError   = null;\n\n  /** Handlers */\n  self._getUserMediaSuccess = function(newStream) {};\n  self._getUserMediaError   = function(error)     {};\n\n  self._getUserMedia = function() {\n    debug.log('__UserMedia._getUserMedia(): self._constraints: ' + JSON.stringify(self._constraints));\n    getUserMedia( self._constraints, self._getUserMediaSuccess, self._getUserMediaError );\n  };\n\n  return self;\n};\n/**\n *\n * @constrictor\n * @returns {_UserMedia}\n * @private\n */\nvar _UserMedia = function() {\n  var self = new __UserMedia();\n  /**\n   * Local media stream from camera and microphone\n   * @memberOf _UserMedia\n   * @type {MediaStream}\n   * @private\n   */\n  self._stream      = null;\n//  /**\n//   * Local media stream from camera and microphone\n//   * @memberOf _UserMedia\n//   * @type {Object}\n//   */\n//  Object.defineProperty(self, \"stream\", {\n//    get: function () {\n//      return self._stream;\n//    }\n//  });\n\n  /**\n   * @memberOf _UserMedia\n   * @type {boolean}\n   * @private\n   */\n  self._isWaitingUser = false;\n  /**\n   * @memberOf _UserMedia\n   * @type {boolean}\n   */\n  Object.defineProperty(self, 'isWaitingUser', {\n    get: function () {\n      return self._isWaitingUser;\n    }\n  });\n  /**\n   * @memberOf _UserMedia\n   * @type {boolean}\n   * @private\n   */\n  self._isActive      = false;\n  /**\n   * @memberOf _UserMedia\n   * @type {boolean}\n   */\n  Object.defineProperty(self, 'isActive', {\n    get: function () {\n      return self._isActive;\n    }\n  });\n  /**\n   * @memberOf _UserMedia\n   * @param {MediaStream} stream\n   * @private\n   */\n  self._storeStream = function(stream) {\n\n    function setObjectEventDebug(object, prop, debugMethod) {\n      object[prop] = function(event) { debug[debugMethod]('_UserMedia: mediaTrack.'+prop+': kind: '+object.kind+', event:', event); };\n    }\n    /**\n     *\n     * @param { MediaStreamTrack[] } tracks\n     */\n    function setTracksDebug(tracks) {\n      var i, len;\n      for (len=tracks.length, i=0; i<len; ++i) {\n        setObjectEventDebug(tracks[i], 'onended',  'warn');\n        setObjectEventDebug(tracks[i], 'onmute',   'log');\n        setObjectEventDebug(tracks[i], 'onoverconstrained', 'warn');\n        setObjectEventDebug(tracks[i], 'onunmute', 'log');\n      }\n    }\n\n    // Store local stream\n    self._stream = stream;\n\n    // Assign event handlers to stream\n    self._stream.onEnded = function() {\n      debug.error('_UserMedia._storeStream(): _stream.onEnded(): that.stream:', self._stream);\n      //self.stop();\n    };\n\n    // Assign event handlers to stream tracks\n    setTracksDebug(stream.getTracks());\n    //setTracksDebug(stream.getAudioTracks());\n    //setTracksDebug(stream.getVideoTracks());\n  };\n\n  /**\n   * Get information on devices used for the stream\n   * @param {MediaStream} stream\n   * @private\n   */\n  self._printStreamInfo = function(stream) {\n    var msg;\n    var audioTracks = stream.getAudioTracks();\n    if (audioTracks.length > 0) {\n      debug.info('_UserMedia._printStreamInfo(): Using Audio device: \\'' + audioTracks[0].label + '\\'');\n\n      msg = '_UserMedia._printStreamInfo(): audioTracks[0].readyState is \\''+audioTracks[0].readyState+'\\'';\n      if (audioTracks[0].readyState === 'ended') { debug.warn(msg); }\n      else { debug.log(msg); }\n    } else { debug.warn('_UserMedia._printStreamInfo(): stream does not contains audioTracks'); }\n\n    var videoTracks = stream.getVideoTracks();\n    if (videoTracks.length > 0) {\n      debug.info('_UserMedia._printStreamInfo(): Using Video device: \\'' + videoTracks[0].label + '\\'');\n\n      msg = '_UserMedia._printStreamInfo(): videoTracks[0].readyState is \\''+videoTracks[0].readyState+'\\'';\n      if (videoTracks[0].readyState === 'ended') { debug.warn(msg); }\n      else { debug.log(msg); }\n    } else { debug.warn('_UserMedia._printStreamInfo(): stream does not contains videoTracks'); }\n  };\n  /**\n   * @memberOf _UserMedia\n   * @param {MediaStream} newStream\n   * @private\n   */\n  self._getUserMediaSuccess = function(newStream) {\n    debug.debug('_UserMedia._getUserMediaSuccess(): newStream:', newStream);\n\n    self._isWaitingUser = false;\n    self._isActive      = true;\n\n    self._storeStream(newStream);\n\n    self._printStreamInfo(newStream);\n\n    if (self._onGetUserMediaSuccess) { self._onGetUserMediaSuccess( self._stream ); }\n  };\n  /**\n   * @memberOf _UserMedia\n   * @param error\n   * @private\n   */\n  self._getUserMediaError = function(error) {\n    debug.debug('_UserMedia._getUserMediaError():', error);\n\n    self._isWaitingUser = false;\n    self._isActive      = false;\n\n    if (self._onGetUserMediaError) { self._onGetUserMediaError( error ); }\n  };\n  /**\n   * @memberOf _UserMedia\n   * @returns {boolean}\n   */\n  self.isStarted = function() {\n    return !! self._stream;\n  };\n  /**\n   * @memberOf _UserMedia\n   */\n  self.start = function() {};\n  /**\n   * Stop local media\n   * @memberOf _UserMedia\n   */\n  self.stop = function() {\n    self._isActive = false;\n    if (self._stream !== null) {\n      self._stream.stop();\n      self._stream = null;\n    }\n  };\n\n  return self;\n};\n\n/**\n *\n * @param {MediaConstraints} mediaConstraints\n * @returns {UserMedia}\n * @constructor\n */\nvar UserMedia = function( mediaConstraints ) {\n  var self = new _UserMedia();\n  //self._constraints = mediaConstraints.getValue();\n\n//  self.isActive      = false;\n//  self.isWaitingUser = false;\n\n//  self.stream        = null;        /** Local media stream from camera and microphone **/\n\n  /**\n   *\n   * @type {MediaConstraints}\n   */\n  self.constraints   = mediaConstraints || new MediaConstraints();\n\n  self.audioSource = null; /** Preferred audio source **/\n  self.videoSource = null; /** Preferred video source **/\n\n  /** Event handlers **/\n\n  self.onStart = null;\n  self.onStop  = null;\n  //self.onError = null;\n\n  var super_getMediaSuccess = self._getUserMediaSuccess;\n  /**\n   * onGetUserMediaSuccess\n   * @param {MediaStream} newStream\n   */\n  self._getUserMediaSuccess = function (newStream) {\n//   // debug.groupCollapsed('UserMedia.start(): onGetUserMediaSuccess()');\n//    debug.debug('UserMedia.start(): onGetUserMediaSuccess(): newStream:', newStream);\n//\n//    self._isWaitingUser = false;\n//    self._isActive      = true;\n//\n//    /** Store local stream **/\n//    self.stream = new MediaStreamView( newStream );\n//\n//    //window.s = self.stream;\n//\n//    self.stream.onEnded = function() {\n//      debug.log('UserMedia.onGetUserMediaSuccess(): self.stream.onEnded(): self.stream:', self.stream);\n//      self.stop();\n//    };\n//\n    super_getMediaSuccess(newStream);\n\n    self.stream = new MediaStreamView( self._stream );\n    debug.log('UserMedia._getUserMediaSuccess(): self.stream:', self.stream);\n\n    if (self.onGetUserMediaSuccess) { self.onGetUserMediaSuccess( self.stream ); }\n    if (self.onStart) { self.onStart( self.stream ); }\n    self.emit('start', self.stream);\n//    //debug.groupEnd();\n  };\n\n  /**\n   * Attempt to get screen was unsuccessful\n   *\n   * @param {object|string} error\n   **/\n  self.onGetUserScreenError = function (error) {\n    //if (self.constraints.getScreenEnabled() || self.constraints.getDesktopEnabled()) {\n    debug.error('UserMedia.onGetUserMediaError1() error: ', error);\n    self._isWaitingUser = false;\n    self._isActive = false;\n    //if (self.onError) { self.onError(error); }\n    self.emit('error', error);\n    self.emit('start', null);\n    //}\n  };\n\n  /**\n   * Attempt to get audio & video was unsuccessful\n   *\n   * @param {object|string} error\n   **/\n  self.onGetUserVideoAudioError = function (error) {\n    // Trying one more time with disabled video\n    debug.warn('UserMedia.onGetUserVideoAudioError() error: ', error);\n    self._startAudioOnly();\n  };\n\n  /**\n   * Attempt to get audio only was also unsuccessful\n   *\n   * @param {object|string} error\n   **/\n  self.onGetUserAudioOnlyError = function (error) {\n    self._isWaitingUser = false;\n    self._isActive      = false;\n    debug.error('UserMedia.onGetUserAudioOnlyError() error: ', error);\n    //if (self.onError) { self.onError(error); }\n    self.emit('error', error);\n    self.emit('start', null);\n  };\n\n  self._startScreen = function() {\n    self._onGetUserMediaError = self.onGetUserScreenError;\n    // this statement verifies chrome extension availability\n    // if installed and available then it will invoke extension API\n    // otherwise it will fallback to command-line based screen capturing API\n    if (DetectRTC.screen.chromeMediaSource === 'desktop') {\n\n      if (!DetectRTC.screen.sourceId) {\n\n        DetectRTC.screen.getSourceId(function (error) {\n          // if exception occurred or access denied\n          if (error && error == 'PermissionDeniedError') {\n            alert('PermissionDeniedError: User denied to share content of his screen.');\n          }\n          self.constraints.setDesktopEnabled(DetectRTC.screen.sourceId);\n          debug.log('_startScreen(): 1 self._constraints: ' + JSON.stringify(self._constraints));\n          self._constraints = self.constraints.getValue();\n          self._getUserMedia();\n        });\n\n      } else {\n        self.constraints.setDesktopEnabled(DetectRTC.screen.sourceId);\n        debug.log('_startScreen(): 2 self._constraints: ' + JSON.stringify(self._constraints));\n        self._constraints = self.constraints.getValue();\n        self._getUserMedia();\n      }\n    } else {\n      self.constraints.setDesktopEnabled(DetectRTC.screen.sourceId);\n      debug.log('_startScreen(): 3 self._constraints: ' + JSON.stringify(self._constraints));\n      self._constraints = self.constraints.getValue();\n      self._getUserMedia();\n    }\n  };\n\n  self._startVideoAudio = function() {\n    self._onGetUserMediaError = self.onGetUserVideoAudioError;\n    if (self.audioSource) { self.constraints.setAudioSource(self.audioSource); }\n    if (self.videoSource) { self.constraints.setVideoSource(self.videoSource); }\n    self._constraints = self.constraints.getValue();\n    debug.log('_startVideoAudio(): self._constraints: ' + JSON.stringify(self._constraints));\n    self._getUserMedia();\n  };\n\n  self._startAudioOnly = function() {\n    self._onGetUserMediaError = self.onGetUserAudioOnlyError;\n    self.constraints.setVideoEnabled(false);\n    self._constraints = self.constraints.getValue();\n    debug.log('UserMedia._startAudioOnly(): self._constraints: ' + JSON.stringify(self._constraints));\n    self._getUserMedia();\n  };\n\n  self.start = function() {\n    //debug.groupCollapsed('UserMedia.start()');\n    if ( ! isWebRTCCompatible() ) {\n      debug.error('UserMedia.start(): Currently the browser you are using does not support webRTC.');\n    } else {\n      // Check if we still were waiting for user confirmation to access media\n      if (self._isWaitingUser) {\n        debug.error('UserMedia.start(): isWaitingUser:', self._isWaitingUser);\n      }\n      self._isWaitingUser = true;\n\n      if ( !self._isActive ) {\n        if (self.mediaType === MEDIA_TYPE.SCREEN) {\n          self._startScreen();\n        } else {\n          self._startVideoAudio();\n        }\n\n      } else {\n        //delayedRepositionAll()\n        if (self.onStart) { self.onStart(); }\n        self.emit('start', self.stream);\n      }\n    }\n    //debug.groupEnd();\n  };\n\n  var super_stop = self.stop;\n  self.stop = function() {\n    if (self.stream) {\n      self.stream.stop();\n      self.stream = null;\n      super_stop();\n\n      if (self.onStop) { self.onStop(); }\n      self.emit('stop');\n    } else {\n      super_stop();\n    }\n  };\n\n  return self;\n};\n\n\nif (typeof module !== 'undefined') {\n  module.exports  = UserMedia;\n}\n\nif (typeof window !== 'undefined') {\n  window.UserMedia  = UserMedia;\n}\n"
  ]
}